<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuyaTracker CLM Enterprise</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            width: 120px;
            height: auto;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .demo-credentials {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            color: #6c757d;
        }

        .demo-credentials strong {
            color: #495057;
        }

        /* Main App Styles */
        .app-container {
            display: none;
            min-height: 100vh;
            background: #f5f6fa;
        }

        .app-header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-logo img {
            width: 40px;
            height: 40px;
        }

        .app-logo h1 {
            font-size: 24px;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .app-main {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .nav-item.active {
            background: #667eea;
            color: white;
            border-left-color: #764ba2;
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-value {
            font-size: 36px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .kpi-label {
            color: #7f8c8d;
            font-size: 16px;
        }

        .kpi-trend {
            margin-top: 10px;
            font-size: 14px;
        }

        .trend-up {
            color: #27ae60;
        }

        .trend-down {
            color: #e74c3c;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Pending Approvals */
        .pending-approvals {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .approval-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .approval-item:last-child {
            border-bottom: none;
        }

        .approval-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .approval-info p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .approval-actions {
            display: flex;
            gap: 10px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-pending {
            background: #fef9e7;
            color: #f39c12;
        }

        .status-draft {
            background: #eaecee;
            color: #95a5a6;
        }

        .status-approved {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-rejected {
            background: #fadbd8;
            color: #e74c3c;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        /* View Options */
        .view-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .view-btn:hover {
            background: #f8f9fa;
        }

        .view-btn.active:hover {
            background: #5a6fd8;
        }

        /* List and Card Views */
        .vendor-view {
            display: none;
        }

        .vendor-view.active {
            display: block;
        }

        .list-view, .card-view {
            display: none;
        }

        .list-view.active, .card-view.active {
            display: block;
        }

        .list-item {
            background: white;
            padding: 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Workflow Form Styles */
        .info-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }

        .info-box h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-box p {
            margin-bottom: 8px;
            font-size: 14px;
            color: #6c757d;
        }

        .approver-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .approver-item select {
            flex: 1;
        }

        .approver-item .approval-order {
            flex: 0 0 100px;
        }

        .approver-item .btn {
            flex: 0 0 auto;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card-item:hover {
            transform: translateY(-5px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-main {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .content {
                order: 1;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }
        }

        /* Activity Feed */
        .activity-feed {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 25px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
        }

        .activity-icon.contract {
            background: #e8f4fd;
            color: #3498db;
        }

        /* Loading Animation */
        .loading {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* OCR Steps */
        .ocr-step {
            min-height: 300px;
        }

        /* GenAI Contract Preview */
        #contractPreview {
            border: 1px solid #ddd;
            font-family: 'Times New Roman', serif;
        }

        #contractPreview h2, #contractPreview h3 {
            margin-top: 20px;
            margin-bottom: 10px;
        }

        #contractPreview p {
            margin-bottom: 10px;
            text-align: justify;
        }

        .activity-icon.vendor {
            background: #fef9e7;
            color: #f39c12;
        }

        .activity-icon.workflow {
            background: #d5f4e6;
            color: #27ae60;
        }

        .activity-content h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .activity-content p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .activity-time {
            margin-left: auto;
            color: #95a5a6;
            font-size: 12px;
        }

        /* Settings Tabs */
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 20px;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
        }

        .settings-tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            background: white;
        }

        .settings-tab:hover {
            background: #f8f9fa;
        }

        .settings-tab.active {
            border-bottom-color: #667eea;
            background: #f8f9fa;
        }

        .settings-content {
            background: white;
            padding: 25px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .setting-info p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        /* Approval Indicators */
        .approval-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .approval-indicator.procurement {
            background: #fef9e7;
            color: #f39c12;
        }

        .approval-indicator.approved {
            background: #d5f4e6;
            color: #27ae60;
        }

        .approval-indicator.rejected {
            background: #fadbd8;
            color: #e74c3c;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .alert-error {
            background: #fadbd8;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .alert-warning {
            background: #fef9e7;
            color: #f39c12;
            border: 1px solid #f39c12;
        }

        .alert-info {
            background: #e8f4fd;
            color: #3498db;
            border: 1px solid #3498db;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <svg class="login-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="url(#gradient)" />
                <text x="50" y="60" text-anchor="middle" fill="white" font-size="24" font-weight="bold">R</text>
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea" />
                        <stop offset="100%" style="stop-color:#764ba2" />
                    </linearGradient>
                </defs>
            </svg>
            
            <h1 class="login-title">RuyaTracker CLM</h1>
            <p class="login-subtitle">Enterprise Contract Lifecycle Management</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="login-btn">Sign In</button>
            </form>
            
            <div class="demo-credentials">
                <strong>Demo Credentials:</strong><br>
                <strong>Admin:</strong> admin@ruyatrack.com / admin123<br>
                <strong>Manager:</strong> manager@ruyatrack.com / manager123<br>
                <strong>Procurement:</strong> procurement@ruyatrack.com / proc123<br>
                <strong>Finance:</strong> finance@ruyatrack.com / fin123
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="app-logo">
                <svg width="40" height="40" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="url(#headerGradient)" />
                    <text x="50" y="60" text-anchor="middle" fill="white" font-size="24" font-weight="bold">R</text>
                    <defs>
                        <linearGradient id="headerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea" />
                            <stop offset="100%" style="stop-color:#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>RuyaTracker CLM Enterprise</h1>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <span id="userName">Administrator</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <div class="app-main">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <i>üìä</i> Dashboard
                </div>
                <div class="nav-item" onclick="showSection('contracts')">
                    <i>üìÑ</i> Contracts
                </div>
                <div class="nav-item" onclick="showSection('vendors')">
                    <i>üè¢</i> Vendors
                </div>
                <div class="nav-item" onclick="showSection('workflows')">
                    <i>‚ö°</i> Workflows
                </div>
                <div class="nav-item" onclick="showSection('analytics')">
                    <i>üìà</i> Analytics
                </div>
                <div class="nav-item" onclick="showSection('users')">
                    <i>üë•</i> Users
                </div>
                <div class="nav-item" onclick="showSection('settings')">
                    <i>‚öôÔ∏è</i> Settings
                </div>
            </nav>

            <!-- Main Content -->
            <main class="content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <h2 class="section-title">
                        <i>üìä</i> Dashboard
                    </h2>

                    <!-- KPI Cards -->
                    <div class="dashboard-grid">
                        <div class="kpi-card">
                            <div class="kpi-value" id="totalContracts">12</div>
                            <div class="kpi-label">Total Contracts</div>
                            <div class="kpi-trend trend-up">‚Üó +2 this month</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="activeVendors">8</div>
                            <div class="kpi-label">Active Vendors</div>
                            <div class="kpi-trend trend-up">‚Üó +1 this month</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="pendingApprovals">5</div>
                            <div class="kpi-label">Pending Approvals</div>
                            <div class="kpi-trend trend-down">‚Üò -2 this week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="totalValue">2.4M</div>
                            <div class="kpi-label">Total Contract Value (SAR)</div>
                            <div class="kpi-trend trend-up">‚Üó +15% this quarter</div>
                        </div>
                    </div>

                    <!-- Pending Approvals Section -->
                    <div class="pending-approvals">
                        <h3 style="margin-bottom: 20px; color: #2c3e50;">Pending Approvals</h3>
                        <div id="pendingApprovalsList">
                            <!-- Pending approvals will be populated here -->
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3 class="chart-title">Contract Value Distribution</h3>
                            <div class="chart-container">
                                <svg width="300" height="300" id="contractValueChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Vendor Performance</h3>
                            <div class="chart-container">
                                <svg width="300" height="250" id="vendorPerformanceChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Contract Status Overview</h3>
                            <div class="chart-container">
                                <svg width="300" height="300" id="contractStatusChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Monthly Contract Trends</h3>
                            <div class="chart-container">
                                <svg width="350" height="250" id="monthlyTrendsChart"></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="activity-feed">
                        <h3 style="margin-bottom: 20px; color: #2c3e50;">Recent Activity</h3>
                        <div id="activityFeed">
                            <!-- Activity items will be populated here -->
                        </div>
                    </div>
                </section>

                <!-- Contracts Section -->
                <section id="contracts" class="section">
                    <h2 class="section-title">
                        <i>üìÑ</i> Contracts
                    </h2>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Contract Management</h3>
                            <div class="table-actions">
                                <button class="btn btn-primary" onclick="openAddContractModal()">
                                    <i>‚ûï</i> Add Contract
                                </button>
                                <button class="btn btn-success" onclick="openGenAIContractModal()">
                                    <i>ü§ñ</i> GenAI Contract
                                </button>
                                <button class="btn btn-warning" onclick="openOCRUploadModal()">
                                    <i>üìÑ</i> OCR Upload
                                </button>
                                <button class="btn btn-secondary" onclick="generateContractReport()">
                                    <i>üìä</i> Generate Report
                                </button>
                            </div>
                        </div>
                        
                        <table id="contractsTable">
                            <thead>
                                <tr>
                                    <th>Contract ID</th>
                                    <th>Title</th>
                                    <th>Vendor</th>
                                    <th>Value (SAR)</th>
                                    <th>Status</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contractsTableBody">
                                <!-- Contract rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Vendors Section -->
                <section id="vendors" class="section">
                    <h2 class="section-title">
                        <i>üè¢</i> Vendors
                    </h2>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Vendor Management</h3>
                            <div class="table-actions">
                                <div class="view-options">
                                    <button class="view-btn active" onclick="switchVendorView('table')">Table</button>
                                    <button class="view-btn" onclick="switchVendorView('list')">List</button>
                                    <button class="view-btn" onclick="switchVendorView('cards')">Cards</button>
                                </div>
                                <button class="btn btn-primary" onclick="openAddVendorModal()">
                                    <i>‚ûï</i> Add Vendor
                                </button>
                            </div>
                        </div>

                        <!-- Table View -->
                        <div id="vendorTableView" class="vendor-view active">
                            <table id="vendorsTable">
                                <thead>
                                    <tr>
                                        <th>Vendor ID</th>
                                        <th>Name</th>
                                        <th>Contact</th>
                                        <th>Email</th>
                                        <th>Category</th>
                                        <th>Rating</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="vendorsTableBody">
                                    <!-- Vendor rows will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- List View -->
                        <div id="vendorListView" class="vendor-view list-view">
                            <div id="vendorsList">
                                <!-- Vendor list items will be populated here -->
                            </div>
                        </div>

                        <!-- Card View -->
                        <div id="vendorCardView" class="vendor-view card-view">
                            <div class="card-grid" id="vendorsCards">
                                <!-- Vendor cards will be populated here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Workflows Section -->
                <section id="workflows" class="section">
                    <h2 class="section-title">
                        <i>‚ö°</i> Workflows
                    </h2>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Workflow Management</h3>
                            <div class="table-actions">
                                <button class="btn btn-primary" onclick="openAddWorkflowModal()">
                                    <i>‚ûï</i> Create Workflow
                                </button>
                            </div>
                        </div>
                        
                        <table id="workflowsTable">
                            <thead>
                                <tr>
                                    <th>Workflow ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Assigned To</th>
                                    <th>Created Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="workflowsTableBody">
                                <!-- Workflow rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics" class="section">
                    <h2 class="section-title">
                        <i>üìà</i> Analytics & Reports
                    </h2>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3 class="chart-title">Financial Overview</h3>
                            <div class="chart-container">
                                <svg width="350" height="250" id="financialChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Workflow Status Distribution</h3>
                            <div class="chart-container">
                                <svg width="300" height="300" id="workflowStatusChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Vendor Category Distribution</h3>
                            <div class="chart-container">
                                <svg width="300" height="300" id="vendorCategoryChart"></svg>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title">Contract Performance Metrics</h3>
                            <div class="chart-container">
                                <svg width="350" height="250" id="performanceChart"></svg>
                            </div>
                        </div>
                    </div>

                    <div class="table-container" style="margin-top: 30px;">
                        <div class="table-header">
                            <h3 class="table-title">Export Reports</h3>
                            <div class="table-actions">
                                <button class="btn btn-success" onclick="exportReport('pdf')">
                                    <i>üìÑ</i> Export PDF
                                </button>
                                <button class="btn btn-success" onclick="exportReport('excel')">
                                    <i>üìä</i> Export Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="users" class="section">
                    <h2 class="section-title">
                        <i>üë•</i> User Management
                    </h2>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">System Users</h3>
                            <div class="table-actions">
                                <button class="btn btn-primary" onclick="openAddUserModal()">
                                    <i>‚ûï</i> Add User
                                </button>
                            </div>
                        </div>
                        
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Department</th>
                                    <th>Status</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- User rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="section">
                    <h2 class="section-title">
                        <i>‚öôÔ∏è</i> System Settings
                    </h2>

                    <div class="settings-tabs">
                        <div class="settings-tab active" onclick="showSettingsTab('general')">General</div>
                        <div class="settings-tab" onclick="showSettingsTab('audit')">Audit Trail</div>
                        <div class="settings-tab" onclick="showSettingsTab('notifications')">Notifications</div>
                        <div class="settings-tab" onclick="showSettingsTab('integrations')">Integrations</div>
                        <div class="settings-tab" onclick="showSettingsTab('security')">Security</div>
                        <div class="settings-tab" onclick="showSettingsTab('backup')">Backup & Recovery</div>
                    </div>

                    <div class="settings-content">
                        <!-- General Settings -->
                        <div id="generalSettings" class="settings-section active">
                            <div class="settings-group">
                                <h3>System Configuration</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>System Name</h4>
                                        <p>Display name for the CLM system</p>
                                    </div>
                                    <input type="text" class="form-control" value="RuyaTracker CLM Enterprise" style="width: 250px;">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Default Currency</h4>
                                        <p>Primary currency for contract values</p>
                                    </div>
                                    <select class="form-control" style="width: 150px;">
                                        <option value="SAR" selected>SAR (Saudi Riyal)</option>
                                        <option value="USD">USD (US Dollar)</option>
                                        <option value="EUR">EUR (Euro)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Date Format</h4>
                                        <p>System-wide date display format</p>
                                    </div>
                                    <select class="form-control" style="width: 150px;">
                                        <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Timezone</h4>
                                        <p>System timezone for all operations</p>
                                    </div>
                                    <select class="form-control" style="width: 200px;">
                                        <option value="Asia/Riyadh" selected>Asia/Riyadh (GMT+3)</option>
                                        <option value="UTC">UTC (GMT+0)</option>
                                        <option value="America/New_York">America/New_York (GMT-5)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Audit Trail Settings -->
                        <div id="auditSettings" class="settings-section">
                            <div class="settings-group">
                                <h3>Audit Configuration</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Enable Audit Logging</h4>
                                        <p>Track all user actions and system changes</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Retention Period</h4>
                                        <p>How long to keep audit logs</p>
                                    </div>
                                    <select class="form-control" style="width: 150px;">
                                        <option value="90">90 days</option>
                                        <option value="180">180 days</option>
                                        <option value="365" selected>1 year</option>
                                        <option value="1095">3 years</option>
                                        <option value="1825">5 years</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Export Audit Logs</h4>
                                        <p>Download audit trail reports</p>
                                    </div>
                                    <button class="btn btn-secondary" onclick="exportAuditLogs()">Export Logs</button>
                                </div>
                            </div>
                        </div>

                        <!-- Notification Settings -->
                        <div id="notificationSettings" class="settings-section">
                            <div class="settings-group">
                                <h3>Email Notifications</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>SMTP Server</h4>
                                        <p>Email server configuration</p>
                                    </div>
                                    <input type="text" class="form-control" value="smtp.ruyatrack.com" style="width: 200px;">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>SMTP Port</h4>
                                        <p>Email server port</p>
                                    </div>
                                    <input type="number" class="form-control" value="587" style="width: 100px;">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Contract Approval Notifications</h4>
                                        <p>Send emails for contract approvals</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Vendor Approval Notifications</h4>
                                        <p>Send emails for vendor approvals</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Integration Settings -->
                        <div id="integrationSettings" class="settings-section">
                            <div class="settings-group">
                                <h3>System Integrations</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Active Directory Integration</h4>
                                        <p>Connect with corporate AD for user authentication</p>
                                    </div>
                                    <div class="toggle-switch" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>ERP Integration</h4>
                                        <p>Sync with enterprise resource planning system</p>
                                    </div>
                                    <div class="toggle-switch" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>API Access</h4>
                                        <p>Enable REST API for third-party integrations</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Test Integration</h4>
                                        <p>Test connectivity with external systems</p>
                                    </div>
                                    <button class="btn btn-secondary" onclick="testIntegration()">Test Connection</button>
                                </div>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div id="securitySettings" class="settings-section">
                            <div class="settings-group">
                                <h3>Security Configuration</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Two-Factor Authentication</h4>
                                        <p>Require 2FA for all users</p>
                                    </div>
                                    <div class="toggle-switch" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Password Policy</h4>
                                        <p>Enforce strong password requirements</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Session Timeout</h4>
                                        <p>Automatic logout after inactivity</p>
                                    </div>
                                    <select class="form-control" style="width: 150px;">
                                        <option value="15">15 minutes</option>
                                        <option value="30" selected>30 minutes</option>
                                        <option value="60">1 hour</option>
                                        <option value="120">2 hours</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Backup Settings -->
                        <div id="backupSettings" class="settings-section">
                            <div class="settings-group">
                                <h3>Backup Configuration</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Automatic Backups</h4>
                                        <p>Schedule regular system backups</p>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSetting(this)">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Backup Frequency</h4>
                                        <p>How often to create backups</p>
                                    </div>
                                    <select class="form-control" style="width: 150px;">
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Create Manual Backup</h4>
                                        <p>Generate backup now</p>
                                    </div>
                                    <button class="btn btn-secondary" onclick="createBackup()">Create Backup</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add Contract Modal -->
    <div id="addContractModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Contract</h3>
                <span class="close" onclick="closeModal('addContractModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addContractForm">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Contract Title</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-col">
                            <label>Vendor</label>
                            <select class="form-control" name="vendor" required>
                                <option value="">Select Vendor</option>
                                <option value="Microsoft Corporation">Microsoft Corporation</option>
                                <option value="Oracle Systems">Oracle Systems</option>
                                <option value="SAP Solutions">SAP Solutions</option>
                                <option value="IBM Services">IBM Services</option>
                                <option value="Accenture">Accenture</option>
                                <option value="Deloitte">Deloitte</option>
                                <option value="KPMG">KPMG</option>
                                <option value="PwC">PwC</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Contract Value (SAR)</label>
                            <input type="number" class="form-control" name="value" required>
                        </div>
                        <div class="form-col">
                            <label>Start Date</label>
                            <input type="date" class="form-control" name="startDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>End Date</label>
                            <input type="date" class="form-control" name="endDate" required>
                        </div>
                        <div class="form-col">
                            <label>Category</label>
                            <select class="form-control" name="category" required>
                                <option value="">Select Category</option>
                                <option value="Software License">Software License</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="Maintenance">Maintenance</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Support">Support</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Priority</label>
                            <select class="form-control" name="priority" required>
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Description</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Upload Contract Document</label>
                            <input type="file" class="form-control" name="document" accept=".pdf,.doc,.docx">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addContractModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveContract()">Save Contract</button>
            </div>
        </div>
    </div>

    <!-- View Contract Modal -->
    <div id="viewContractModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Contract Details</h3>
                <span class="close" onclick="closeModal('viewContractModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="contractDetails">
                    <!-- Contract details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('viewContractModal')">Close</button>
                <button type="button" class="btn btn-warning" onclick="editContractFromView()">Edit</button>
            </div>
        </div>
    </div>

    <!-- Edit Contract Modal -->
    <div id="editContractModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Contract</h3>
                <span class="close" onclick="closeModal('editContractModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editContractForm">
                    <input type="hidden" name="id" id="editContractId">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Contract Title</label>
                            <input type="text" class="form-control" name="title" id="editContractTitle" required>
                        </div>
                        <div class="form-col">
                            <label>Contract ID</label>
                            <input type="text" class="form-control" name="contractId" id="editContractContractId" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Vendor</label>
                            <select class="form-control" name="vendor" id="editContractVendor" required>
                                <option value="">Select Vendor</option>
                                <option value="Microsoft Corporation">Microsoft Corporation</option>
                                <option value="Oracle Systems">Oracle Systems</option>
                                <option value="SAP Solutions">SAP Solutions</option>
                                <option value="IBM Services">IBM Services</option>
                                <option value="Accenture">Accenture</option>
                                <option value="Deloitte">Deloitte</option>
                                <option value="KPMG">KPMG</option>
                                <option value="PwC">PwC</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Contract Value (SAR)</label>
                            <input type="number" class="form-control" name="value" id="editContractValue" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Start Date</label>
                            <input type="date" class="form-control" name="startDate" id="editContractStartDate" required>
                        </div>
                        <div class="form-col">
                            <label>End Date</label>
                            <input type="date" class="form-control" name="endDate" id="editContractEndDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Status</label>
                            <select class="form-control" name="status" id="editContractStatus" required>
                                <option value="Draft">Draft</option>
                                <option value="P1">P1 - Procurement Review</option>
                                <option value="P2">P2 - Manager Approval</option>
                                <option value="PF">PF - Final Approval</option>
                                <option value="Approved">Approved</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Priority</label>
                            <select class="form-control" name="priority" id="editContractPriority" required>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Description</label>
                            <textarea class="form-control" name="description" id="editContractDescription" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editContractModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateContract()">Update Contract</button>
            </div>
        </div>
    </div>

    <!-- Add Vendor Modal -->
    <div id="addVendorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Vendor</h3>
                <span class="close" onclick="closeModal('addVendorModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addVendorForm">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Vendor Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="form-col">
                            <label>Contact Person</label>
                            <input type="text" class="form-control" name="contact" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="form-col">
                            <label>Phone</label>
                            <input type="tel" class="form-control" name="phone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Address</label>
                            <textarea class="form-control" name="address" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Category</label>
                            <select class="form-control" name="category" required>
                                <option value="">Select Category</option>
                                <option value="Technology">Technology</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Logistics">Logistics</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Rating</label>
                            <select class="form-control" name="rating">
                                <option value="5">5 - Excellent</option>
                                <option value="4" selected>4 - Good</option>
                                <option value="3">3 - Average</option>
                                <option value="2">2 - Below Average</option>
                                <option value="1">1 - Poor</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Upload Documents (Optional)</label>
                            <input type="file" class="form-control" name="documents" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.png">
                            <small style="color: #7f8c8d;">You can upload multiple files (PDF, DOC, images)</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addVendorModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveVendor()">Save Vendor</button>
            </div>
        </div>
    </div>

    <!-- View Vendor Modal -->
    <div id="viewVendorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Vendor Details</h3>
                <span class="close" onclick="closeModal('viewVendorModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="vendorDetails">
                    <!-- Vendor details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('viewVendorModal')">Close</button>
                <button type="button" class="btn btn-warning" onclick="editVendorFromView()">Edit</button>
            </div>
        </div>
    </div>

    <!-- Edit Vendor Modal -->
    <div id="editVendorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Vendor</h3>
                <span class="close" onclick="closeModal('editVendorModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editVendorForm">
                    <input type="hidden" name="id" id="editVendorId">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Vendor Name</label>
                            <input type="text" class="form-control" name="name" id="editVendorName" required>
                        </div>
                        <div class="form-col">
                            <label>Contact Person</label>
                            <input type="text" class="form-control" name="contact" id="editVendorContact" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Email</label>
                            <input type="email" class="form-control" name="email" id="editVendorEmail" required>
                        </div>
                        <div class="form-col">
                            <label>Phone</label>
                            <input type="tel" class="form-control" name="phone" id="editVendorPhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Address</label>
                            <textarea class="form-control" name="address" id="editVendorAddress" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Category</label>
                            <select class="form-control" name="category" id="editVendorCategory" required>
                                <option value="">Select Category</option>
                                <option value="Technology">Technology</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Logistics">Logistics</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Rating</label>
                            <select class="form-control" name="rating" id="editVendorRating">
                                <option value="5">5 - Excellent</option>
                                <option value="4">4 - Good</option>
                                <option value="3">3 - Average</option>
                                <option value="2">2 - Below Average</option>
                                <option value="1">1 - Poor</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Status</label>
                            <select class="form-control" name="status" id="editVendorStatus" required>
                                <option value="Pending">Pending Approval</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editVendorModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateVendor()">Update Vendor</button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New User</h3>
                <span class="close" onclick="closeModal('addUserModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Full Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="form-col">
                            <label>Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Role</label>
                            <select class="form-control" name="role" required>
                                <option value="">Select Role</option>
                                <option value="Administrator">Administrator</option>
                                <option value="Manager">Manager</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Finance">Finance</option>
                                <option value="IT">IT</option>
                                <option value="Analyst">Analyst</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Department</label>
                            <select class="form-control" name="department" required>
                                <option value="">Select Department</option>
                                <option value="Administration">Administration</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Finance">Finance</option>
                                <option value="IT">Information Technology</option>
                                <option value="Legal">Legal</option>
                                <option value="Operations">Operations</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Phone</label>
                            <input type="tel" class="form-control" name="phone">
                        </div>
                        <div class="form-col">
                            <label>Employee ID</label>
                            <input type="text" class="form-control" name="employeeId">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Temporary Password</label>
                            <input type="password" class="form-control" name="password" required>
                            <small style="color: #7f8c8d;">User will be required to change password on first login</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveUser()">Save User</button>
            </div>
        </div>
    </div>

    <!-- GenAI Contract Generation Modal -->
    <div id="genAIContractModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ü§ñ GenAI Contract Generation</h3>
                <span class="close" onclick="closeModal('genAIContractModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="genAIContractForm">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Contract Type</label>
                            <select class="form-control" name="contractType" required>
                                <option value="">Select Contract Type</option>
                                <option value="Software License Agreement">Software License Agreement</option>
                                <option value="Professional Services Agreement">Professional Services Agreement</option>
                                <option value="Maintenance and Support Agreement">Maintenance and Support Agreement</option>
                                <option value="Consulting Services Agreement">Consulting Services Agreement</option>
                                <option value="Non-Disclosure Agreement">Non-Disclosure Agreement</option>
                                <option value="Service Level Agreement">Service Level Agreement</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Contract Duration</label>
                            <select class="form-control" name="duration" required>
                                <option value="">Select Duration</option>
                                <option value="6 months">6 months</option>
                                <option value="1 year">1 year</option>
                                <option value="2 years">2 years</option>
                                <option value="3 years">3 years</option>
                                <option value="5 years">5 years</option>
                                <option value="Custom">Custom Duration</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Party A (Your Organization)</label>
                            <input type="text" class="form-control" name="partyA" value="RuyaTracker Enterprise" required>
                        </div>
                        <div class="form-col">
                            <label>Party B (Vendor/Contractor)</label>
                            <select class="form-control" name="partyB" required>
                                <option value="">Select Vendor</option>
                                <option value="Microsoft Corporation">Microsoft Corporation</option>
                                <option value="Oracle Systems">Oracle Systems</option>
                                <option value="SAP Solutions">SAP Solutions</option>
                                <option value="IBM Services">IBM Services</option>
                                <option value="Accenture">Accenture</option>
                                <option value="Deloitte">Deloitte</option>
                                <option value="KPMG">KPMG</option>
                                <option value="PwC">PwC</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Contract Value (SAR)</label>
                            <input type="number" class="form-control" name="contractValue" required>
                        </div>
                        <div class="form-col">
                            <label>Payment Terms</label>
                            <select class="form-control" name="paymentTerms" required>
                                <option value="">Select Payment Terms</option>
                                <option value="Net 30">Net 30 days</option>
                                <option value="Net 60">Net 60 days</option>
                                <option value="Net 90">Net 90 days</option>
                                <option value="Monthly">Monthly payments</option>
                                <option value="Quarterly">Quarterly payments</option>
                                <option value="Annual">Annual payment</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Governing Law</label>
                            <select class="form-control" name="governingLaw" required>
                                <option value="">Select Governing Law</option>
                                <option value="Kingdom of Saudi Arabia" selected>Kingdom of Saudi Arabia</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="European Union">European Union</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Currency</label>
                            <select class="form-control" name="currency" required>
                                <option value="SAR" selected>SAR (Saudi Riyal)</option>
                                <option value="USD">USD (US Dollar)</option>
                                <option value="EUR">EUR (Euro)</option>
                                <option value="GBP">GBP (British Pound)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Special Requirements/Clauses</label>
                            <textarea class="form-control" name="specialRequirements" rows="3" placeholder="Enter any specific requirements, clauses, or terms you want included in the contract..."></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Include Standard Clauses</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="confidentiality" checked> Confidentiality
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="termination" checked> Termination
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="liability" checked> Liability Limitation
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="intellectual_property" checked> Intellectual Property
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="force_majeure" checked> Force Majeure
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" name="clauses" value="dispute_resolution" checked> Dispute Resolution
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
                <div id="genAIProgress" style="display: none; text-align: center; padding: 20px;">
                    <div class="loading"></div>
                    <p style="margin-top: 10px;">Generating contract with AI... Please wait.</p>
                </div>
                <div id="genAIResult" style="display: none;">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">‚úÖ Contract Generated Successfully!</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5>Generated Contract Preview:</h5>
                        <div id="contractPreview" style="max-height: 300px; overflow-y: auto; background: white; padding: 15px; border-radius: 4px; font-family: 'Times New Roman', serif; line-height: 1.6; font-size: 14px;"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('genAIContractModal')">Cancel</button>
                <button type="button" class="btn btn-success" id="generateContractBtn" onclick="generateAIContract()">ü§ñ Generate Contract</button>
                <button type="button" class="btn btn-primary" id="saveGeneratedContractBtn" onclick="saveGeneratedContract()" style="display: none;">üíæ Save Contract</button>
                <button type="button" class="btn btn-warning" id="downloadContractBtn" onclick="downloadContract()" style="display: none;">üìÑ Download PDF</button>
            </div>
        </div>
    </div>

    <!-- OCR Upload Modal -->
    <div id="ocrUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìÑ OCR Document Upload & Processing</h3>
                <span class="close" onclick="closeModal('ocrUploadModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="ocrUploadStep" class="ocr-step">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">Upload Contract Document</h4>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Select Document</label>
                            <input type="file" class="form-control" id="ocrFileInput" accept=".pdf,.jpg,.jpeg,.png,.tiff,.bmp" required>
                            <small style="color: #7f8c8d;">Supported formats: PDF, JPG, PNG, TIFF, BMP</small>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Document Type</label>
                            <select class="form-control" id="ocrDocumentType" required>
                                <option value="">Select Document Type</option>
                                <option value="contract">Contract Agreement</option>
                                <option value="invoice">Invoice</option>
                                <option value="purchase_order">Purchase Order</option>
                                <option value="proposal">Proposal</option>
                                <option value="amendment">Contract Amendment</option>
                                <option value="other">Other Document</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Processing Options</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" id="extractText" checked> Extract Full Text
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" id="extractKeyData" checked> Extract Key Data
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" id="extractDates" checked> Extract Dates
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" id="extractAmounts" checked> Extract Amounts
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="checkbox" id="extractParties" checked> Extract Parties
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="ocrProcessingStep" class="ocr-step" style="display: none; text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <h4 style="color: #3498db; margin: 20px 0;">Processing Document...</h4>
                    <p id="ocrProcessingStatus">Analyzing document structure...</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Text Extraction:</span>
                            <span id="textExtractionStatus">‚è≥ Processing...</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Data Recognition:</span>
                            <span id="dataRecognitionStatus">‚è≥ Waiting...</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Contract Analysis:</span>
                            <span id="contractAnalysisStatus">‚è≥ Waiting...</span>
                        </div>
                    </div>
                </div>

                <div id="ocrResultsStep" class="ocr-step" style="display: none;">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">‚úÖ OCR Processing Complete!</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h5 style="color: #2c3e50; margin-bottom: 10px;">üìä Extracted Key Data</h5>
                            <div id="extractedKeyData">
                                <!-- Key data will be populated here -->
                            </div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h5 style="color: #2c3e50; margin-bottom: 10px;">üìÖ Important Dates</h5>
                            <div id="extractedDates">
                                <!-- Dates will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h5 style="color: #2c3e50; margin-bottom: 10px;">üìÑ Extracted Text</h5>
                        <div id="extractedText" style="max-height: 200px; overflow-y: auto; background: white; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; line-height: 1.4;">
                            <!-- Extracted text will be populated here -->
                        </div>
                    </div>

                    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                        <h5 style="color: #2c3e50; margin-bottom: 10px;">ü§ñ AI Contract Analysis</h5>
                        <div id="contractAnalysis">
                            <!-- AI analysis will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('ocrUploadModal')">Cancel</button>
                <button type="button" class="btn btn-primary" id="processOCRBtn" onclick="processOCRDocument()">üîç Process Document</button>
                <button type="button" class="btn btn-success" id="createContractFromOCRBtn" onclick="createContractFromOCR()" style="display: none;">üìÑ Create Contract</button>
                <button type="button" class="btn btn-warning" id="downloadOCRResultsBtn" onclick="downloadOCRResults()" style="display: none;">üìä Download Results</button>
            </div>
        </div>
    </div>

    <!-- Add Workflow Modal -->
    <div id="addWorkflowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Workflow</h3>
                <span class="close" onclick="closeModal('addWorkflowModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addWorkflowForm">
                    <div class="form-row">
                        <div class="form-col">
                            <label>Workflow Template</label>
                            <select class="form-control" name="template" onchange="handleWorkflowTemplateChange()" required>
                                <option value="">Select Template</option>
                                <option value="default_contract_approval">Default: Contract Approval</option>
                                <option value="default_vendor_addition">Default: Vendor Addition</option>
                                <option value="default_license_renewal">Default: License Renewal</option>
                                <option value="default_document_review">Default: Document Review</option>
                                <option value="default_budget_approval">Default: Budget Approval</option>
                                <option value="custom">Custom Workflow</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Workflow Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                    </div>
                    
                    <!-- Custom Workflow Type Selection (shown only for custom workflows) -->
                    <div id="customWorkflowType" class="form-row" style="display: none;">
                        <div class="form-col">
                            <label>Workflow Type</label>
                            <select class="form-control" name="workflowType">
                                <option value="contract">Contract Management</option>
                                <option value="vendor">Vendor Management</option>
                                <option value="license">License Renewal</option>
                                <option value="document">Document Review</option>
                                <option value="budget">Budget Approval</option>
                                <option value="procurement">Procurement Process</option>
                                <option value="compliance">Compliance Review</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Custom Type (if Other)</label>
                            <input type="text" class="form-control" name="customType" placeholder="Enter custom type">
                        </div>
                    </div>

                    <!-- Default Workflow Info (shown for default templates) -->
                    <div id="defaultWorkflowInfo" class="form-row" style="display: none;">
                        <div class="form-col">
                            <div class="info-box">
                                <h4>Default Workflow Information</h4>
                                <p id="defaultWorkflowDescription"></p>
                                <p><strong>Default Approvers:</strong> <span id="defaultApprovers"></span></p>
                                <p><strong>Estimated Duration:</strong> <span id="defaultDuration"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Approvers Section -->
                    <div id="customApproversSection" class="form-row" style="display: none;">
                        <div class="form-col">
                            <label>Custom Approval Sequence</label>
                            <p class="help-text">Define the approval sequence by selecting roles and their order. Each step must be completed before the next.</p>
                            <div id="approversList">
                                <div class="approver-item">
                                    <div class="approver-step">
                                        <label>Step 1:</label>
                                        <select class="form-control approver-select" name="approvers[]" required>
                                            <option value="">Select Role/Function</option>
                                            <optgroup label="Management Roles">
                                                <option value="admin@ruyatrack.com">Administrator</option>
                                                <option value="manager@ruyatrack.com">Manager</option>
                                            </optgroup>
                                            <optgroup label="Functional Roles">
                                                <option value="procurement@ruyatrack.com">Procurement Team</option>
                                                <option value="finance@ruyatrack.com">Finance Team</option>
                                                <option value="it@ruyatrack.com">IT Team</option>
                                                <option value="analyst@ruyatrack.com">Business Analyst</option>
                                            </optgroup>
                                            <optgroup label="Specialized Roles">
                                                <option value="legal@ruyatrack.com">Legal Team</option>
                                                <option value="compliance@ruyatrack.com">Compliance Officer</option>
                                                <option value="security@ruyatrack.com">Security Team</option>
                                            </optgroup>
                                        </select>
                                        <input type="text" class="form-control step-description" name="stepDescriptions[]" placeholder="Step description (e.g., Technical Review, Budget Approval)" />
                                        <button type="button" class="btn btn-danger btn-sm" onclick="removeApprover(this)" style="display: none;">Remove</button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="addApproverStep()">+ Add Approval Step</button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Assigned To (Initial)</label>
                            <select class="form-control" name="assignedTo" required>
                                <option value="">Select User</option>
                                <option value="admin@ruyatrack.com">Administrator</option>
                                <option value="manager@ruyatrack.com">Manager</option>
                                <option value="procurement@ruyatrack.com">Procurement Team</option>
                                <option value="finance@ruyatrack.com">Finance Team</option>
                                <option value="it@ruyatrack.com">IT Team</option>
                                <option value="analyst@ruyatrack.com">Business Analyst</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label>Priority</label>
                            <select class="form-control" name="priority" required>
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Due Date</label>
                            <input type="date" class="form-control" name="dueDate" required>
                        </div>
                        <div class="form-col">
                            <label>Auto-Apply to Future Items</label>
                            <select class="form-control" name="autoApply">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Description</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addWorkflowModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveWorkflow()">Create Workflow</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let currentUserRole = null;
        let contracts = [];
        let vendors = [];
        let workflows = [];
        let users = [];
        let currentVendorView = 'table';

        // User Roles and Permissions
        const userRoles = {
            'admin@ruyatrack.com': { role: 'Administrator', name: 'Administrator', department: 'Administration', permissions: ['all'] },
            'manager@ruyatrack.com': { role: 'Manager', name: 'Manager', department: 'Management', permissions: ['contracts', 'vendors', 'workflows', 'reports'] },
            'procurement@ruyatrack.com': { role: 'Procurement', name: 'Procurement Officer', department: 'Procurement', permissions: ['contracts', 'vendors', 'workflows'] },
            'finance@ruyatrack.com': { role: 'Finance', name: 'Finance Manager', department: 'Finance', permissions: ['contracts', 'reports', 'analytics'] },
            'it@ruyatrack.com': { role: 'IT', name: 'IT Administrator', department: 'IT', permissions: ['users', 'settings', 'reports'] },
            'analyst@ruyatrack.com': { role: 'Analyst', name: 'Business Analyst', department: 'Analytics', permissions: ['reports', 'analytics'] }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            // Check for existing session
            const savedSession = localStorage.getItem('clm_session');
            if (savedSession) {
                try {
                    const sessionData = JSON.parse(savedSession);
                    if (userRoles[sessionData.email]) {
                        currentUser = sessionData;
                        currentUserRole = userRoles[sessionData.email];
                        showApp();
                        return;
                    }
                } catch (e) {
                    localStorage.removeItem('clm_session');
                }
            }

            // Show login page
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';

            // Setup login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        });

        // Authentication Functions
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Check if user exists in our system
            if (userRoles[email]) {
                // For demo purposes, accept any password
                currentUser = { email: email };
                currentUserRole = userRoles[email];
                
                // Save session
                localStorage.setItem('clm_session', JSON.stringify(currentUser));
                
                showApp();
                showNotification('Welcome to RuyaTracker CLM Enterprise!', 'success');
            } else {
                showNotification('Invalid credentials. Please use demo accounts.', 'error');
            }
        }

        function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Update user info in header
            document.getElementById('userName').textContent = currentUserRole.name;
            document.getElementById('userAvatar').textContent = currentUserRole.name.charAt(0);
            
            // Initialize data
            initializeData();
            
            // Load dashboard
            showSection('dashboard');
        }

        function logout() {
            localStorage.removeItem('clm_session');
            currentUser = null;
            currentUserRole = null;
            
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            
            // Reset form
            document.getElementById('loginForm').reset();
        }

        // Navigation Functions
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Find and activate the correct nav item
            navItems.forEach(item => {
                if (item.textContent.toLowerCase().includes(sectionId)) {
                    item.classList.add('active');
                }
            });
            
            // Load section-specific data
            switch(sectionId) {
                case 'dashboard':
                    loadDashboardData();
                    renderCharts();
                    break;
                case 'contracts':
                    loadContractsData();
                    break;
                case 'vendors':
                    loadVendorsData();
                    break;
                case 'workflows':
                    loadWorkflowsData();
                    break;
                case 'analytics':
                    renderAnalyticsCharts();
                    break;
                case 'users':
                    loadUsersData();
                    break;
            }
        }

        // Data Initialization
        function initializeData() {
            // Initialize sample contracts
            contracts = [
                {
                    id: 1,
                    contractId: 'CNT-2024-001',
                    title: 'Microsoft Office 365 Enterprise License',
                    vendor: 'Microsoft Corporation',
                    value: 180000,
                    status: 'Active',
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                    category: 'Software License',
                    priority: 'High',
                    description: 'Enterprise-wide Office 365 licensing for 500 users',
                    document: 'microsoft_office365_contract.pdf'
                },
                {
                    id: 2,
                    contractId: 'CNT-2024-002',
                    title: 'Oracle Database Maintenance',
                    vendor: 'Oracle Systems',
                    value: 95000,
                    status: 'P1',
                    startDate: '2024-02-01',
                    endDate: '2025-01-31',
                    category: 'Maintenance',
                    priority: 'Medium',
                    description: 'Annual maintenance and support for Oracle Database systems',
                    document: 'oracle_maintenance_contract.pdf'
                },
                {
                    id: 3,
                    contractId: 'CNT-2024-003',
                    title: 'SAP Implementation Services',
                    vendor: 'SAP Solutions',
                    value: 450000,
                    status: 'P2',
                    startDate: '2024-03-01',
                    endDate: '2024-09-30',
                    category: 'Professional Services',
                    priority: 'Critical',
                    description: 'SAP ERP implementation and customization services',
                    document: 'sap_implementation_contract.pdf'
                }
            ];

            // Initialize sample vendors
            vendors = [
                {
                    id: 1,
                    vendorId: 'VND-001',
                    name: 'Microsoft Corporation',
                    contact: 'John Smith',
                    email: 'john.smith@microsoft.com',
                    phone: '+1-425-882-8080',
                    address: 'One Microsoft Way, Redmond, WA 98052, USA',
                    category: 'Technology',
                    rating: 5,
                    status: 'Active',
                    documents: ['microsoft_profile.pdf', 'microsoft_certifications.pdf']
                },
                {
                    id: 2,
                    vendorId: 'VND-002',
                    name: 'Oracle Systems',
                    contact: 'Sarah Johnson',
                    email: 'sarah.johnson@oracle.com',
                    phone: '+1-650-506-7000',
                    address: '500 Oracle Parkway, Redwood City, CA 94065, USA',
                    category: 'Technology',
                    rating: 4,
                    status: 'Active',
                    documents: ['oracle_profile.pdf']
                },
                {
                    id: 3,
                    vendorId: 'VND-003',
                    name: 'SAP Solutions',
                    contact: 'Michael Brown',
                    email: 'michael.brown@sap.com',
                    phone: '+49-6227-7-47474',
                    address: 'Dietmar-Hopp-Allee 16, 69190 Walldorf, Germany',
                    category: 'Technology',
                    rating: 5,
                    status: 'Pending',
                    documents: ['sap_profile.pdf', 'sap_certifications.pdf']
                },
                {
                    id: 4,
                    vendorId: 'VND-004',
                    name: 'Accenture',
                    contact: 'Emily Davis',
                    email: 'emily.davis@accenture.com',
                    phone: '+1-312-693-0161',
                    address: '161 N Clark St, Chicago, IL 60601, USA',
                    category: 'Consulting',
                    rating: 4,
                    status: 'Active',
                    documents: ['accenture_profile.pdf']
                }
            ];

            // Initialize sample workflows
            workflows = [
                {
                    id: 1,
                    workflowId: 'WF-2024-001',
                    name: 'Oracle Contract Approval',
                    type: 'Contract Approval',
                    status: 'In Progress',
                    assignedTo: 'procurement@ruyatrack.com',
                    createdDate: '2024-01-15',
                    dueDate: '2024-01-25',
                    priority: 'Medium',
                    description: 'Approval workflow for Oracle Database Maintenance contract'
                },
                {
                    id: 2,
                    workflowId: 'WF-2024-002',
                    name: 'SAP Vendor Approval',
                    type: 'Vendor Approval',
                    status: 'Pending',
                    assignedTo: 'manager@ruyatrack.com',
                    createdDate: '2024-01-20',
                    dueDate: '2024-01-30',
                    priority: 'High',
                    description: 'New vendor approval for SAP Solutions'
                }
            ];

            // Initialize sample users
            users = [
                {
                    id: 1,
                    userId: 'USR-001',
                    name: 'Administrator',
                    email: 'admin@ruyatrack.com',
                    role: 'Administrator',
                    department: 'Administration',
                    status: 'Active',
                    lastLogin: '2024-01-22 09:30:00',
                    phone: '+966-11-123-4567',
                    employeeId: 'EMP-001'
                },
                {
                    id: 2,
                    userId: 'USR-002',
                    name: 'Manager',
                    email: 'manager@ruyatrack.com',
                    role: 'Manager',
                    department: 'Management',
                    status: 'Active',
                    lastLogin: '2024-01-22 08:45:00',
                    phone: '+966-11-123-4568',
                    employeeId: 'EMP-002'
                },
                {
                    id: 3,
                    userId: 'USR-003',
                    name: 'Procurement Officer',
                    email: 'procurement@ruyatrack.com',
                    role: 'Procurement',
                    department: 'Procurement',
                    status: 'Active',
                    lastLogin: '2024-01-21 16:20:00',
                    phone: '+966-11-123-4569',
                    employeeId: 'EMP-003'
                },
                {
                    id: 4,
                    userId: 'USR-004',
                    name: 'Finance Manager',
                    email: 'finance@ruyatrack.com',
                    role: 'Finance',
                    department: 'Finance',
                    status: 'Active',
                    lastLogin: '2024-01-22 07:15:00',
                    phone: '+966-11-123-4570',
                    employeeId: 'EMP-004'
                }
            ];

            // Save data to localStorage for persistence
            saveDataToStorage();
        }

        // Data Persistence Functions
        function saveDataToStorage() {
            localStorage.setItem('clm_contracts', JSON.stringify(contracts));
            localStorage.setItem('clm_vendors', JSON.stringify(vendors));
            localStorage.setItem('clm_workflows', JSON.stringify(workflows));
            localStorage.setItem('clm_users', JSON.stringify(users));
        }

        function loadDataFromStorage() {
            const savedContracts = localStorage.getItem('clm_contracts');
            const savedVendors = localStorage.getItem('clm_vendors');
            const savedWorkflows = localStorage.getItem('clm_workflows');
            const savedUsers = localStorage.getItem('clm_users');

            if (savedContracts) contracts = JSON.parse(savedContracts);
            if (savedVendors) vendors = JSON.parse(savedVendors);
            if (savedWorkflows) workflows = JSON.parse(savedWorkflows);
            if (savedUsers) users = JSON.parse(savedUsers);
        }

        // Dashboard Functions
        function loadDashboardData() {
            // Load data from storage
            loadDataFromStorage();

            // Update KPI cards
            document.getElementById('totalContracts').textContent = contracts.length;
            document.getElementById('activeVendors').textContent = vendors.filter(v => v.status === 'Active').length;
            document.getElementById('pendingApprovals').textContent = workflows.filter(w => w.status === 'Pending' || w.status === 'In Progress').length;
            
            const totalValue = contracts.reduce((sum, contract) => sum + contract.value, 0);
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);

            // Load pending approvals
            loadPendingApprovals();

            // Load recent activity
            loadRecentActivity();
        }

        function loadPendingApprovals() {
            const pendingList = document.getElementById('pendingApprovalsList');
            const userRole = currentUserRole.role;
            
            let pendingItems = [];

            // Add contract approvals based on user role
            contracts.forEach(contract => {
                if ((contract.status === 'P1' && userRole === 'Procurement') ||
                    (contract.status === 'P2' && userRole === 'Manager') ||
                    (contract.status === 'PF' && userRole === 'Administrator')) {
                    pendingItems.push({
                        type: 'contract',
                        id: contract.id,
                        title: `Contract: ${contract.title}`,
                        description: `${contract.vendor} - ${formatCurrency(contract.value)}`,
                        status: contract.status
                    });
                }
            });

            // Add vendor approvals
            vendors.forEach(vendor => {
                if (vendor.status === 'Pending' && (userRole === 'Procurement' || userRole === 'Manager')) {
                    pendingItems.push({
                        type: 'vendor',
                        id: vendor.id,
                        title: `Vendor: ${vendor.name}`,
                        description: `${vendor.category} - ${vendor.contact}`,
                        status: 'Pending'
                    });
                }
            });

            // Add workflow approvals
            workflows.forEach(workflow => {
                if ((workflow.status === 'Pending' || workflow.status === 'In Progress') && 
                    workflow.assignedTo === currentUser.email) {
                    pendingItems.push({
                        type: 'workflow',
                        id: workflow.id,
                        title: `Workflow: ${workflow.name}`,
                        description: `${workflow.type} - Due: ${workflow.dueDate}`,
                        status: workflow.status
                    });
                }
            });

            if (pendingItems.length === 0) {
                pendingList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;">No pending approvals</p>';
                return;
            }

            pendingList.innerHTML = pendingItems.map(item => `
                <div class="approval-item">
                    <div class="approval-info">
                        <h4>${item.title}</h4>
                        <p>${item.description}</p>
                    </div>
                    <div class="approval-actions">
                        <button class="btn btn-success btn-sm" onclick="approveItem('${item.type}', ${item.id})">Approve</button>
                        <button class="btn btn-danger btn-sm" onclick="rejectItem('${item.type}', ${item.id})">Reject</button>
                        <button class="btn btn-secondary btn-sm" onclick="viewItem('${item.type}', ${item.id})">View</button>
                    </div>
                </div>
            `).join('');
        }

        function loadRecentActivity() {
            const activityFeed = document.getElementById('activityFeed');
            
            // Load real activities from localStorage
            const storedActivities = JSON.parse(localStorage.getItem('clm_activities')) || [];
            
            if (storedActivities.length === 0) {
                // Show default message if no activities
                activityFeed.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon contract">
                            üìã
                        </div>
                        <div class="activity-content">
                            <h4>No recent activities</h4>
                            <p>Start by adding contracts, vendors, or workflows</p>
                        </div>
                        <div class="activity-time">Now</div>
                    </div>
                `;
                return;
            }

            // Show last 5 activities
            const recentActivities = storedActivities.slice(0, 5);
            
            activityFeed.innerHTML = recentActivities.map(activity => {
                const iconMap = {
                    'contract': 'üìÑ',
                    'vendor': 'üè¢',
                    'workflow': '‚ö°',
                    'user': 'üë§',
                    'report': 'üìä',
                    'system': '‚öôÔ∏è'
                };
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${activity.type}">
                            ${iconMap[activity.type] || 'üìã'}
                        </div>
                        <div class="activity-content">
                            <h4>${activity.type.charAt(0).toUpperCase() + activity.type.slice(1)} ${activity.description.split(' ')[0]}</h4>
                            <p>${activity.description}</p>
                        </div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `;
            }).join('');
        }

        // Contract Functions
        function loadContractsData() {
            loadDataFromStorage();
            const tbody = document.getElementById('contractsTableBody');
            
            tbody.innerHTML = contracts.map(contract => `
                <tr>
                    <td>${contract.contractId}</td>
                    <td>${contract.title}</td>
                    <td>${contract.vendor}</td>
                    <td>${formatCurrency(contract.value)}</td>
                    <td><span class="status-badge status-${contract.status.toLowerCase()}">${contract.status}</span></td>
                    <td>${formatDate(contract.startDate)}</td>
                    <td>${formatDate(contract.endDate)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewContract(${contract.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editContract(${contract.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteContract(${contract.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Contract ID Generation
        function generateContractId() {
            const currentYear = new Date().getFullYear();
            const existingContracts = contracts.filter(c => c.contractId && c.contractId.startsWith(`CLM-${currentYear}`));
            
            let nextNumber = 1;
            if (existingContracts.length > 0) {
                const numbers = existingContracts.map(c => {
                    const match = c.contractId.match(/CLM-\d{4}-(\d{3})/);
                    return match ? parseInt(match[1]) : 0;
                });
                nextNumber = Math.max(...numbers) + 1;
            }
            
            return `CLM-${currentYear}-${nextNumber.toString().padStart(3, '0')}`;
        }

        function openAddContractModal() {
            document.getElementById('addContractModal').style.display = 'block';
        }

        function addContract() {
            const form = document.getElementById('addContractForm');
            const formData = new FormData(form);
            
            const newContract = {
                id: Date.now(),
                title: formData.get('title'),
                contractId: generateContractId(), // Auto-generate contract ID
                vendor: formData.get('vendor'),
                value: parseInt(formData.get('value')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                status: 'Draft', // Default status
                priority: formData.get('priority'),
                category: formData.get('category'),
                description: formData.get('description'),
                type: formData.get('category') || 'General Agreement',
                document: formData.get('document') || null,
                createdBy: currentUser.name,
                createdDate: new Date().toISOString()
            };

            contracts.push(newContract);
            saveDataToStorage();
            closeModal('addContractModal');
            loadContractsData();
            updateDashboardKPIs();
            
            // Add activity
            addActivity('contract', `New contract added: ${newContract.title} (${newContract.contractId})`, currentUser.name);
            
            showNotification(`Contract added successfully! Contract ID: ${newContract.contractId}`, 'success');
            
            // Create approval workflow if needed
            createContractApprovalWorkflow(newContract);
        }

        function viewContract(id) {
            const contract = contracts.find(c => c.id === id);
            if (!contract) return;

            const detailsHtml = `
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Contract ID:</strong></label>
                        <p>${contract.contractId}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Title:</strong></label>
                        <p>${contract.title}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Vendor:</strong></label>
                        <p>${contract.vendor}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Value:</strong></label>
                        <p>${formatCurrency(contract.value)}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Status:</strong></label>
                        <p><span class="status-badge status-${contract.status.toLowerCase()}">${contract.status}</span></p>
                    </div>
                    <div class="form-col">
                        <label><strong>Priority:</strong></label>
                        <p>${contract.priority}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Start Date:</strong></label>
                        <p>${formatDate(contract.startDate)}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>End Date:</strong></label>
                        <p>${formatDate(contract.endDate)}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Category:</strong></label>
                        <p>${contract.category}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Description:</strong></label>
                        <p>${contract.description || 'No description provided'}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Document:</strong></label>
                        <p>${contract.document ? `<a href="#" onclick="viewDocument('${contract.document}')">${contract.document}</a>` : 'No document attached'}</p>
                    </div>
                </div>
            `;

            document.getElementById('contractDetails').innerHTML = detailsHtml;
            document.getElementById('viewContractModal').style.display = 'block';
        }

        function editContract(id) {
            const contract = contracts.find(c => c.id === id);
            if (!contract) return;

            // Populate edit form
            document.getElementById('editContractId').value = contract.id;
            document.getElementById('editContractTitle').value = contract.title;
            document.getElementById('editContractContractId').value = contract.contractId;
            document.getElementById('editContractVendor').value = contract.vendor;
            document.getElementById('editContractValue').value = contract.value;
            document.getElementById('editContractStartDate').value = contract.startDate;
            document.getElementById('editContractEndDate').value = contract.endDate;
            document.getElementById('editContractStatus').value = contract.status;
            document.getElementById('editContractPriority').value = contract.priority;
            document.getElementById('editContractDescription').value = contract.description || '';

            document.getElementById('editContractModal').style.display = 'block';
        }

        function updateContract() {
            const form = document.getElementById('editContractForm');
            const formData = new FormData(form);
            const id = parseInt(formData.get('id'));
            
            const contractIndex = contracts.findIndex(c => c.id === id);
            if (contractIndex === -1) return;

            const oldTitle = contracts[contractIndex].title;
            
            contracts[contractIndex] = {
                ...contracts[contractIndex],
                title: formData.get('title'),
                contractId: formData.get('contractId'),
                vendor: formData.get('vendor'),
                value: parseInt(formData.get('value')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                status: formData.get('status'),
                priority: formData.get('priority'),
                description: formData.get('description')
            };

            saveDataToStorage();
            closeModal('editContractModal');
            loadContractsData();
            updateDashboardKPIs();
            
            // Add activity
            addActivity('contract', `Contract updated: ${contracts[contractIndex].title}`, currentUser.name);
            
            showNotification('Contract updated successfully!', 'success');
        }

        function deleteContract(id) {
            if (confirm('Are you sure you want to delete this contract?')) {
                const contract = contracts.find(c => c.id === id);
                const contractTitle = contract ? contract.title : 'Unknown Contract';
                
                contracts = contracts.filter(c => c.id !== id);
                saveDataToStorage();
                loadContractsData();
                updateDashboardKPIs();
                
                // Add activity
                addActivity('contract', `Contract deleted: ${contractTitle}`, currentUser.name);
                
                showNotification('Contract deleted successfully!', 'success');
            }
        }

        function editContractFromView() {
            closeModal('viewContractModal');
            const contractId = parseInt(document.getElementById('contractDetails').dataset.contractId);
            editContract(contractId);
        }

        // Vendor Functions
        function loadVendorsData() {
            loadDataFromStorage();
            
            if (currentVendorView === 'table') {
                loadVendorTableView();
            } else if (currentVendorView === 'list') {
                loadVendorListView();
            } else if (currentVendorView === 'cards') {
                loadVendorCardView();
            }
        }

        function switchVendorView(viewType) {
            currentVendorView = viewType;
            
            // Update view buttons
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all views
            document.querySelectorAll('.vendor-view').forEach(view => view.classList.remove('active'));
            
            // Show selected view
            if (viewType === 'table') {
                document.getElementById('vendorTableView').classList.add('active');
                loadVendorTableView();
            } else if (viewType === 'list') {
                document.getElementById('vendorListView').classList.add('active');
                loadVendorListView();
            } else if (viewType === 'cards') {
                document.getElementById('vendorCardView').classList.add('active');
                loadVendorCardView();
            }
        }

        function loadVendorTableView() {
            const tbody = document.getElementById('vendorsTableBody');
            
            tbody.innerHTML = vendors.map(vendor => `
                <tr>
                    <td>${vendor.vendorId}</td>
                    <td>${vendor.name}</td>
                    <td>${vendor.contact}</td>
                    <td>${vendor.email}</td>
                    <td>${vendor.category}</td>
                    <td>${'‚≠ê'.repeat(vendor.rating)}</td>
                    <td>
                        <span class="status-badge status-${vendor.status.toLowerCase()}">${vendor.status}</span>
                        ${vendor.status === 'Pending' ? '<span class="approval-indicator procurement" data-tooltip="Pending Procurement Approval">üìã P</span>' : ''}
                    </td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewVendor(${vendor.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editVendor(${vendor.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteVendor(${vendor.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadVendorListView() {
            const container = document.getElementById('vendorsList');
            
            container.innerHTML = vendors.map(vendor => `
                <div class="list-item">
                    <div>
                        <h4>${vendor.name}</h4>
                        <p>${vendor.contact} - ${vendor.email} - ${vendor.category}</p>
                        <p>Rating: ${'‚≠ê'.repeat(vendor.rating)} | Status: <span class="status-badge status-${vendor.status.toLowerCase()}">${vendor.status}</span></p>
                    </div>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="viewVendor(${vendor.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editVendor(${vendor.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteVendor(${vendor.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadVendorCardView() {
            const container = document.getElementById('vendorsCards');
            
            container.innerHTML = vendors.map(vendor => `
                <div class="card-item">
                    <h4>${vendor.name}</h4>
                    <p><strong>Contact:</strong> ${vendor.contact}</p>
                    <p><strong>Email:</strong> ${vendor.email}</p>
                    <p><strong>Category:</strong> ${vendor.category}</p>
                    <p><strong>Rating:</strong> ${'‚≠ê'.repeat(vendor.rating)}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${vendor.status.toLowerCase()}">${vendor.status}</span></p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-secondary btn-sm" onclick="viewVendor(${vendor.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editVendor(${vendor.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteVendor(${vendor.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function openAddVendorModal() {
            document.getElementById('addVendorModal').style.display = 'block';
        }

        function saveVendor() {
            const form = document.getElementById('addVendorForm');
            const formData = new FormData(form);
            
            // Validate required fields
            const requiredFields = ['name', 'contact', 'email', 'phone', 'category'];
            for (let field of requiredFields) {
                if (!formData.get(field)) {
                    showNotification(`Please fill in the ${field} field`, 'error');
                    return;
                }
            }
            
            const newVendor = {
                id: Date.now(), // Use timestamp for unique ID
                vendorId: generateUniqueVendorId(), // Generate unique vendor ID
                name: formData.get('name'),
                contact: formData.get('contact'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                address: formData.get('address') || '',
                category: formData.get('category'),
                rating: parseInt(formData.get('rating')) || 3,
                status: 'Pending',
                documents: formData.get('documents') ? [formData.get('documents').name] : [],
                createdDate: new Date().toISOString().split('T')[0],
                createdBy: currentUser?.name || 'System'
            };

            vendors.push(newVendor);
            saveDataToStorage();
            
            // Add activity
            addActivity('vendor', `New vendor "${newVendor.name}" added and pending approval`, currentUser?.name || 'System');
            
            closeModal('addVendorModal');
            loadVendorsData();
            showNotification('Vendor created successfully! Pending approval.', 'success');
            
            // Create vendor approval workflow
            createVendorApprovalWorkflow(newVendor);
            
            // Reset form
            form.reset();
        }

        function generateUniqueVendorId() {
            let maxId = 0;
            vendors.forEach(vendor => {
                if (vendor.vendorId && vendor.vendorId.startsWith('VND-')) {
                    const idNum = parseInt(vendor.vendorId.split('-')[1]);
                    if (idNum > maxId) {
                        maxId = idNum;
                    }
                }
            });
            return `VND-${String(maxId + 1).padStart(3, '0')}`;
        }

        function viewVendor(id) {
            const vendor = vendors.find(v => v.id === id);
            if (!vendor) return;

            const detailsHtml = `
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Vendor ID:</strong></label>
                        <p>${vendor.vendorId}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Name:</strong></label>
                        <p>${vendor.name}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Contact Person:</strong></label>
                        <p>${vendor.contact}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Email:</strong></label>
                        <p>${vendor.email}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Phone:</strong></label>
                        <p>${vendor.phone}</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Category:</strong></label>
                        <p>${vendor.category}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Rating:</strong></label>
                        <p>${'‚≠ê'.repeat(vendor.rating)} (${vendor.rating}/5)</p>
                    </div>
                    <div class="form-col">
                        <label><strong>Status:</strong></label>
                        <p><span class="status-badge status-${vendor.status.toLowerCase()}">${vendor.status}</span></p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Address:</strong></label>
                        <p>${vendor.address || 'No address provided'}</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label><strong>Documents:</strong></label>
                        <p>${vendor.documents && vendor.documents.length > 0 ? 
                            vendor.documents.map(doc => `<a href="#" onclick="viewDocument('${doc}')">${doc}</a>`).join(', ') : 
                            'No documents uploaded'}</p>
                    </div>
                </div>
            `;

            document.getElementById('vendorDetails').innerHTML = detailsHtml;
            document.getElementById('vendorDetails').dataset.vendorId = id;
            document.getElementById('viewVendorModal').style.display = 'block';
        }

        function editVendor(id) {
            const vendor = vendors.find(v => v.id === id);
            if (!vendor) return;

            // Populate edit form
            document.getElementById('editVendorId').value = vendor.id;
            document.getElementById('editVendorName').value = vendor.name;
            document.getElementById('editVendorContact').value = vendor.contact;
            document.getElementById('editVendorEmail').value = vendor.email;
            document.getElementById('editVendorPhone').value = vendor.phone;
            document.getElementById('editVendorAddress').value = vendor.address || '';
            document.getElementById('editVendorCategory').value = vendor.category;
            document.getElementById('editVendorRating').value = vendor.rating;
            document.getElementById('editVendorStatus').value = vendor.status;

            document.getElementById('editVendorModal').style.display = 'block';
        }

        function updateVendor() {
            const form = document.getElementById('editVendorForm');
            const formData = new FormData(form);
            const id = parseInt(formData.get('id'));
            
            const vendorIndex = vendors.findIndex(v => v.id === id);
            if (vendorIndex === -1) return;

            vendors[vendorIndex] = {
                ...vendors[vendorIndex],
                name: formData.get('name'),
                contact: formData.get('contact'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                address: formData.get('address'),
                category: formData.get('category'),
                rating: parseInt(formData.get('rating')),
                status: formData.get('status')
            };

            saveDataToStorage();
            closeModal('editVendorModal');
            loadVendorsData();
            showNotification('Vendor updated successfully!', 'success');
        }

        function deleteVendor(id) {
            if (confirm('Are you sure you want to delete this vendor?')) {
                vendors = vendors.filter(v => v.id !== id);
                saveDataToStorage();
                loadVendorsData();
                showNotification('Vendor deleted successfully!', 'success');
            }
        }

        function editVendorFromView() {
            closeModal('viewVendorModal');
            const vendorId = parseInt(document.getElementById('vendorDetails').dataset.vendorId);
            editVendor(vendorId);
        }

        // Workflow Functions
        function loadWorkflowsData() {
            loadDataFromStorage();
            const tbody = document.getElementById('workflowsTableBody');
            
            tbody.innerHTML = workflows.map(workflow => `
                <tr>
                    <td>${workflow.workflowId}</td>
                    <td>${workflow.name}</td>
                    <td>${workflow.type}</td>
                    <td><span class="status-badge status-${workflow.status.toLowerCase().replace(' ', '-')}">${workflow.status}</span></td>
                    <td>${workflow.assignedTo}</td>
                    <td>${formatDate(workflow.createdDate)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewWorkflow(${workflow.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editWorkflow(${workflow.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteWorkflow(${workflow.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function openAddWorkflowModal() {
            document.getElementById('addWorkflowModal').style.display = 'block';
        }

        // Default workflow templates
        const defaultWorkflowTemplates = {
            'default_contract_approval': {
                name: 'Contract Approval Workflow',
                type: 'Contract Approval',
                description: 'Standard workflow for contract approval process including legal review, budget approval, and final sign-off.',
                approvers: ['procurement@ruyatrack.com', 'finance@ruyatrack.com', 'manager@ruyatrack.com'],
                duration: '5-7 business days',
                steps: ['Initial Review', 'Budget Verification', 'Legal Review', 'Final Approval']
            },
            'default_vendor_addition': {
                name: 'Vendor Addition Workflow',
                type: 'Vendor Approval',
                description: 'Standard workflow for adding new vendors including due diligence, compliance check, and approval.',
                approvers: ['procurement@ruyatrack.com', 'admin@ruyatrack.com'],
                duration: '3-5 business days',
                steps: ['Vendor Verification', 'Compliance Check', 'Final Approval']
            },
            'default_license_renewal': {
                name: 'License Renewal Workflow',
                type: 'License Renewal',
                description: 'Global standard workflow for software license renewals following industry best practices: technical assessment, budget verification, vendor negotiation, legal review, and final approval.',
                approvers: ['it@ruyatrack.com', 'finance@ruyatrack.com', 'procurement@ruyatrack.com', 'manager@ruyatrack.com', 'admin@ruyatrack.com'],
                duration: '7-14 business days',
                steps: [
                    'Technical Assessment & Usage Analysis',
                    'Budget Verification & Cost Analysis', 
                    'Vendor Negotiation & Terms Review',
                    'Legal & Compliance Review',
                    'Management Approval & Final Sign-off'
                ],
                globalStandard: true,
                requirements: [
                    'Current license usage metrics',
                    'Budget allocation confirmation',
                    'Vendor renewal terms',
                    'Compliance requirements check',
                    'Business justification'
                ]
            },
            'default_document_review': {
                name: 'Document Review Workflow',
                type: 'Document Review',
                description: 'Standard workflow for document review and approval process.',
                approvers: ['analyst@ruyatrack.com', 'manager@ruyatrack.com'],
                duration: '2-3 business days',
                steps: ['Initial Review', 'Final Approval']
            },
            'default_budget_approval': {
                name: 'Budget Approval Workflow',
                type: 'Budget Approval',
                description: 'Standard workflow for budget approval process including financial review and management approval.',
                approvers: ['finance@ruyatrack.com', 'manager@ruyatrack.com', 'admin@ruyatrack.com'],
                duration: '3-5 business days',
                steps: ['Financial Review', 'Management Review', 'Final Approval']
            }
        };

        function handleWorkflowTemplateChange() {
            const templateSelect = document.querySelector('select[name="template"]');
            const selectedTemplate = templateSelect.value;
            
            const customWorkflowType = document.getElementById('customWorkflowType');
            const defaultWorkflowInfo = document.getElementById('defaultWorkflowInfo');
            const customApproversSection = document.getElementById('customApproversSection');
            const nameInput = document.querySelector('input[name="name"]');
            
            // Hide all sections first
            customWorkflowType.style.display = 'none';
            defaultWorkflowInfo.style.display = 'none';
            customApproversSection.style.display = 'none';
            
            if (selectedTemplate === 'custom') {
                // Show custom workflow options
                customWorkflowType.style.display = 'block';
                customApproversSection.style.display = 'block';
                nameInput.value = '';
            } else if (selectedTemplate && defaultWorkflowTemplates[selectedTemplate]) {
                // Show default workflow info
                const template = defaultWorkflowTemplates[selectedTemplate];
                defaultWorkflowInfo.style.display = 'block';
                
                // Populate default workflow information
                document.getElementById('defaultWorkflowDescription').textContent = template.description;
                document.getElementById('defaultApprovers').textContent = template.approvers.join(', ');
                document.getElementById('defaultDuration').textContent = template.duration;
                
                // Pre-fill the name
                nameInput.value = template.name;
            }
        }

        function addApproverStep() {
            const approversList = document.getElementById('approversList');
            const approverCount = approversList.children.length;
            const stepNumber = approverCount + 1;
            
            const approverItem = document.createElement('div');
            approverItem.className = 'approver-item';
            approverItem.innerHTML = `
                <div class="approver-step">
                    <label>Step ${stepNumber}:</label>
                    <select class="form-control approver-select" name="approvers[]" required>
                        <option value="">Select Role/Function</option>
                        <optgroup label="Management Roles">
                            <option value="admin@ruyatrack.com">Administrator</option>
                            <option value="manager@ruyatrack.com">Manager</option>
                        </optgroup>
                        <optgroup label="Functional Roles">
                            <option value="procurement@ruyatrack.com">Procurement Team</option>
                            <option value="finance@ruyatrack.com">Finance Team</option>
                            <option value="it@ruyatrack.com">IT Team</option>
                            <option value="analyst@ruyatrack.com">Business Analyst</option>
                        </optgroup>
                        <optgroup label="Specialized Roles">
                            <option value="legal@ruyatrack.com">Legal Team</option>
                            <option value="compliance@ruyatrack.com">Compliance Officer</option>
                            <option value="security@ruyatrack.com">Security Team</option>
                        </optgroup>
                    </select>
                    <input type="text" class="form-control step-description" name="stepDescriptions[]" placeholder="Step description (e.g., Technical Review, Budget Approval)" />
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeApprover(this)">Remove</button>
                </div>
            `;
            
            approversList.appendChild(approverItem);
            
            // Show remove buttons for all items if there's more than one
            if (stepNumber > 1) {
                const removeButtons = approversList.querySelectorAll('.btn-danger');
                removeButtons.forEach(btn => btn.style.display = 'inline-block');
            }
        }

        // Keep the old function for backward compatibility
        function addApprover() {
            addApproverStep();
        }
        function removeApprover(button) {
            const approverItem = button.closest('.approver-item');
            const approversList = document.getElementById('approversList');
            
            // Don't remove if it's the only item
            if (approversList.children.length <= 1) {
                showNotification('At least one approval step is required', 'warning');
                return;
            }
            
            approverItem.remove();
            
            // Update step numbers
            const remainingItems = approversList.querySelectorAll('.approver-item');
            remainingItems.forEach((item, index) => {
                const label = item.querySelector('label');
                if (label) {
                    label.textContent = `Step ${index + 1}:`;
                }
            });
            
            // Hide remove buttons if only one item remains
            if (remainingItems.length <= 1) {
                const removeButtons = approversList.querySelectorAll('.btn-danger');
                removeButtons.forEach(btn => btn.style.display = 'none');
            }
        }

        function saveWorkflow() {
            const form = document.getElementById('addWorkflowForm');
            const formData = new FormData(form);
            const template = formData.get('template');
            
            // Collect approvers for custom workflows
            let approvers = [];
            let approvalSteps = [];
            
            if (template === 'custom') {
                const approverSelects = form.querySelectorAll('select[name="approvers[]"]');
                const stepDescriptions = form.querySelectorAll('input[name="stepDescriptions[]"]');
                
                approverSelects.forEach((select, index) => {
                    if (select.value) {
                        const stepDescription = stepDescriptions[index]?.value || `Approval Step ${index + 1}`;
                        approvers.push({
                            approver: select.value,
                            step: index + 1,
                            description: stepDescription,
                            status: 'Pending'
                        });
                    }
                });
                
                // Create approval steps with descriptions
                approvalSteps = approvers.map((approver, index) => 
                    `Step ${approver.step}: ${approver.description} (${approver.approver.split('@')[0]})`
                );
            } else if (defaultWorkflowTemplates[template]) {
                // Use default template approvers
                const templateData = defaultWorkflowTemplates[template];
                approvers = templateData.approvers.map((approver, index) => ({
                    approver: approver,
                    step: index + 1,
                    status: 'Pending'
                }));
                approvalSteps = templateData.steps;
            }
            
            const workflowType = template === 'custom' ? 
                (formData.get('workflowType') === 'other' ? formData.get('customType') : formData.get('workflowType')) :
                defaultWorkflowTemplates[template]?.type || 'Standard';
            
            const newWorkflow = {
                id: Date.now(), // Use timestamp for unique ID
                workflowId: `WF-2024-${String(workflows.length + 1).padStart(3, '0')}`,
                name: formData.get('name'),
                template: template,
                type: workflowType,
                status: 'Active',
                assignedTo: formData.get('assignedTo'),
                createdDate: new Date().toISOString().split('T')[0],
                dueDate: formData.get('dueDate'),
                priority: formData.get('priority'),
                description: formData.get('description'),
                autoApply: formData.get('autoApply') === 'true',
                approvers: approvers,
                approvalSteps: approvalSteps,
                isCustom: template === 'custom',
                currentStep: 1,
                createdBy: currentUser?.name || 'System'
            };

            workflows.push(newWorkflow);
            saveDataToStorage();
            
            closeModal('addWorkflowModal');
            loadWorkflowsData();
            showNotification(`${template === 'custom' ? 'Custom' : 'Default'} workflow created successfully!`, 'success');
            
            // Reset form
            form.reset();
            document.getElementById('customWorkflowType').style.display = 'none';
            document.getElementById('defaultWorkflowInfo').style.display = 'none';
            document.getElementById('customApproversSection').style.display = 'none';
        }

        function viewWorkflow(id) {
            showNotification(`Viewing workflow ${id}`, 'info');
        }

        function editWorkflow(id) {
            showNotification(`Editing workflow ${id}`, 'info');
        }

        function deleteWorkflow(id) {
            if (confirm('Are you sure you want to delete this workflow?')) {
                workflows = workflows.filter(w => w.id !== id);
                saveDataToStorage();
                loadWorkflowsData();
                showNotification('Workflow deleted successfully!', 'success');
            }
        }

        // User Functions
        function loadUsersData() {
            loadDataFromStorage();
            const tbody = document.getElementById('usersTableBody');
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.userId}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.department}</td>
                    <td><span class="status-badge status-${user.status.toLowerCase()}">${user.status}</span></td>
                    <td>${user.lastLogin}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewUser(${user.id})">View</button>
                        <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deactivateUser(${user.id})">Deactivate</button>
                    </td>
                </tr>
            `).join('');
        }

        function openAddUserModal() {
            document.getElementById('addUserModal').style.display = 'block';
        }

        function saveUser() {
            const form = document.getElementById('addUserForm');
            const formData = new FormData(form);
            
            const newUser = {
                id: users.length + 1,
                userId: `USR-${String(users.length + 1).padStart(3, '0')}`,
                name: formData.get('name'),
                email: formData.get('email'),
                role: formData.get('role'),
                department: formData.get('department'),
                status: 'Active',
                lastLogin: 'Never',
                phone: formData.get('phone'),
                employeeId: formData.get('employeeId')
            };

            users.push(newUser);
            saveDataToStorage();
            
            closeModal('addUserModal');
            loadUsersData();
            showNotification('User created successfully!', 'success');
        }

        function viewUser(id) {
            showNotification(`Viewing user ${id}`, 'info');
        }

        function editUser(id) {
            showNotification(`Editing user ${id}`, 'info');
        }

        function deactivateUser(id) {
            if (confirm('Are you sure you want to deactivate this user?')) {
                const userIndex = users.findIndex(u => u.id === id);
                if (userIndex !== -1) {
                    users[userIndex].status = 'Inactive';
                    saveDataToStorage();
                    loadUsersData();
                    showNotification('User deactivated successfully!', 'success');
                }
            }
        }

        // Settings Functions
        function showSettingsTab(tabName) {
            // Hide all settings sections
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName + 'Settings').classList.add('active');
            
            // Update tab buttons
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function toggleSetting(element) {
            element.classList.toggle('active');
            showNotification('Setting updated successfully!', 'success');
        }

        function exportAuditLogs() {
            showNotification('Audit logs exported successfully!', 'success');
        }

        function testIntegration() {
            showNotification('Integration test completed successfully!', 'success');
        }

        function createBackup() {
            showNotification('Backup created successfully!', 'success');
        }

        // Approval Functions
        function approveItem(type, id) {
            if (type === 'contract') {
                const contract = contracts.find(c => c.id === id);
                if (contract) {
                    if (contract.status === 'P1') {
                        contract.status = 'P2';
                    } else if (contract.status === 'P2') {
                        contract.status = 'PF';
                    } else if (contract.status === 'PF') {
                        contract.status = 'Approved';
                    }
                    saveDataToStorage();
                    showNotification('Contract approved successfully!', 'success');
                }
            } else if (type === 'vendor') {
                const vendor = vendors.find(v => v.id === id);
                if (vendor) {
                    vendor.status = 'Active';
                    saveDataToStorage();
                    showNotification('Vendor approved successfully!', 'success');
                }
            } else if (type === 'workflow') {
                const workflow = workflows.find(w => w.id === id);
                if (workflow) {
                    workflow.status = 'Completed';
                    saveDataToStorage();
                    showNotification('Workflow approved successfully!', 'success');
                }
            }
            
            loadDashboardData();
        }

        function rejectItem(type, id) {
            if (type === 'contract') {
                const contract = contracts.find(c => c.id === id);
                if (contract) {
                    contract.status = 'Rejected';
                    saveDataToStorage();
                    showNotification('Contract rejected!', 'warning');
                }
            } else if (type === 'vendor') {
                const vendor = vendors.find(v => v.id === id);
                if (vendor) {
                    vendor.status = 'Rejected';
                    saveDataToStorage();
                    showNotification('Vendor rejected!', 'warning');
                }
            } else if (type === 'workflow') {
                const workflow = workflows.find(w => w.id === id);
                if (workflow) {
                    workflow.status = 'Rejected';
                    saveDataToStorage();
                    showNotification('Workflow rejected!', 'warning');
                }
            }
            
            loadDashboardData();
        }

        function viewItem(type, id) {
            if (type === 'contract') {
                viewContract(id);
            } else if (type === 'vendor') {
                viewVendor(id);
            } else if (type === 'workflow') {
                viewWorkflow(id);
            }
        }

        // Workflow Creation Functions
        function createContractApprovalWorkflow(contract) {
            const newWorkflow = {
                id: workflows.length + 1,
                workflowId: `WF-2024-${String(workflows.length + 1).padStart(3, '0')}`,
                name: `${contract.title} Approval`,
                type: 'Contract Approval',
                status: 'Pending',
                assignedTo: 'procurement@ruyatrack.com',
                createdDate: new Date().toISOString().split('T')[0],
                dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                priority: contract.priority,
                description: `Approval workflow for contract: ${contract.title}`
            };

            workflows.push(newWorkflow);
            saveDataToStorage();
        }

        function createVendorApprovalWorkflow(vendor) {
            const newWorkflow = {
                id: workflows.length + 1,
                workflowId: `WF-2024-${String(workflows.length + 1).padStart(3, '0')}`,
                name: `${vendor.name} Vendor Approval`,
                type: 'Vendor Approval',
                status: 'Pending',
                assignedTo: 'procurement@ruyatrack.com',
                createdDate: new Date().toISOString().split('T')[0],
                dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                priority: 'Medium',
                description: `Vendor approval workflow for: ${vendor.name}`
            };

            workflows.push(newWorkflow);
            saveDataToStorage();
        }

        // Chart Functions
        function renderCharts() {
            renderContractValueChart();
            renderVendorPerformanceChart();
            renderContractStatusChart();
            renderMonthlyTrendsChart();
        }

        function renderAnalyticsCharts() {
            renderFinancialChart();
            renderWorkflowStatusChart();
            renderVendorCategoryChart();
            renderPerformanceChart();
        }

        function renderContractValueChart() {
            const svg = document.getElementById('contractValueChart');
            if (!svg) return;

            const data = contracts.reduce((acc, contract) => {
                acc[contract.vendor] = (acc[contract.vendor] || 0) + contract


.value;
                return acc;
            }, {});

            const total = Object.values(data).reduce((sum, value) => sum + value, 0);
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'];
            
            let currentAngle = 0;
            const centerX = 150;
            const centerY = 150;
            const radius = 100;

            svg.innerHTML = '';

            Object.entries(data).forEach(([vendor, value], index) => {
                const percentage = (value / total) * 100;
                const angle = (value / total) * 2 * Math.PI;
                
                const x1 = centerX + radius * Math.cos(currentAngle);
                const y1 = centerY + radius * Math.sin(currentAngle);
                const x2 = centerX + radius * Math.cos(currentAngle + angle);
                const y2 = centerY + radius * Math.sin(currentAngle + angle);
                
                const largeArcFlag = angle > Math.PI ? 1 : 0;
                
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    'Z'
                ].join(' ');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                
                // Add hover effect
                path.addEventListener('mouseenter', function() {
                    this.setAttribute('opacity', '0.8');
                    showTooltip(`${vendor}: ${formatCurrency(value)}`);
                });
                
                path.addEventListener('mouseleave', function() {
                    this.setAttribute('opacity', '1');
                    hideTooltip();
                });

                svg.appendChild(path);
                currentAngle += angle;
            });
        }

        function renderVendorPerformanceChart() {
            const svg = document.getElementById('vendorPerformanceChart');
            if (!svg) return;

            const data = vendors.map(vendor => ({
                name: vendor.name.split(' ')[0], // First word only
                rating: vendor.rating
            }));

            const maxRating = 5;
            const barWidth = 40;
            const barSpacing = 10;
            const chartHeight = 200;
            const chartWidth = 300;

            svg.innerHTML = '';

            data.forEach((vendor, index) => {
                const x = 50 + index * (barWidth + barSpacing);
                const barHeight = (vendor.rating / maxRating) * chartHeight;
                const y = chartHeight - barHeight + 30;

                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', '#667eea');
                rect.setAttribute('stroke', 'white');
                rect.setAttribute('stroke-width', '1');

                // Add hover effect
                rect.addEventListener('mouseenter', function() {
                    this.setAttribute('fill', '#5a6fd8');
                    showTooltip(`${vendor.name}: ${vendor.rating} rating`);
                });
                
                rect.addEventListener('mouseleave', function() {
                    this.setAttribute('fill', '#667eea');
                    hideTooltip();
                });

                svg.appendChild(rect);

                // Add label
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x + barWidth / 2);
                text.setAttribute('y', chartHeight + 50);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', '#333');
                text.textContent = vendor.name;
                svg.appendChild(text);
            });
        }

        function renderContractStatusChart() {
            const svg = document.getElementById('contractStatusChart');
            if (!svg) return;

            const statusCounts = contracts.reduce((acc, contract) => {
                acc[contract.status] = (acc[contract.status] || 0) + 1;
                return acc;
            }, {});

            const total = Object.values(statusCounts).reduce((sum, count) => sum + count, 0);
            const colors = {
                'Active': '#27ae60',
                'P1': '#f39c12',
                'P2': '#e67e22',
                'PF': '#9b59b6',
                'Approved': '#2ecc71',
                'Draft': '#95a5a6',
                'Rejected': '#e74c3c'
            };

            let currentAngle = 0;
            const centerX = 150;
            const centerY = 150;
            const outerRadius = 100;
            const innerRadius = 50;

            svg.innerHTML = '';

            Object.entries(statusCounts).forEach(([status, count]) => {
                const angle = (count / total) * 2 * Math.PI;
                
                const x1 = centerX + outerRadius * Math.cos(currentAngle);
                const y1 = centerY + outerRadius * Math.sin(currentAngle);
                const x2 = centerX + outerRadius * Math.cos(currentAngle + angle);
                const y2 = centerY + outerRadius * Math.sin(currentAngle + angle);
                
                const x3 = centerX + innerRadius * Math.cos(currentAngle + angle);
                const y3 = centerY + innerRadius * Math.sin(currentAngle + angle);
                const x4 = centerX + innerRadius * Math.cos(currentAngle);
                const y4 = centerY + innerRadius * Math.sin(currentAngle);
                
                const largeArcFlag = angle > Math.PI ? 1 : 0;
                
                const pathData = [
                    `M ${x1} ${y1}`,
                    `A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    `L ${x3} ${y3}`,
                    `A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${x4} ${y4}`,
                    'Z'
                ].join(' ');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[status] || '#95a5a6');
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                
                // Add hover effect
                path.addEventListener('mouseenter', function() {
                    this.setAttribute('opacity', '0.8');
                    showTooltip(`${status}: ${count} contracts`);
                });
                
                path.addEventListener('mouseleave', function() {
                    this.setAttribute('opacity', '1');
                    hideTooltip();
                });

                svg.appendChild(path);
                currentAngle += angle;
            });
        }

        function renderMonthlyTrendsChart() {
            const svg = document.getElementById('monthlyTrendsChart');
            if (!svg) return;

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const data = [1, 2, 1, 3, 2, 3]; // Sample data
            
            const chartWidth = 300;
            const chartHeight = 200;
            const maxValue = Math.max(...data);

            svg.innerHTML = '';

            // Draw lines
            const points = data.map((value, index) => {
                const x = 50 + (index * (chartWidth - 100) / (data.length - 1));
                const y = chartHeight - (value / maxValue * (chartHeight - 50)) + 30;
                return `${x},${y}`;
            }).join(' ');

            const polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            polyline.setAttribute('points', points);
            polyline.setAttribute('fill', 'none');
            polyline.setAttribute('stroke', '#667eea');
            polyline.setAttribute('stroke-width', '3');
            svg.appendChild(polyline);

            // Draw points
            data.forEach((value, index) => {
                const x = 50 + (index * (chartWidth - 100) / (data.length - 1));
                const y = chartHeight - (value / maxValue * (chartHeight - 50)) + 30;

                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', '5');
                circle.setAttribute('fill', '#667eea');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', '2');

                // Add hover effect
                circle.addEventListener('mouseenter', function() {
                    this.setAttribute('r', '7');
                    showTooltip(`${months[index]}: ${value} contracts`);
                });
                
                circle.addEventListener('mouseleave', function() {
                    this.setAttribute('r', '5');
                    hideTooltip();
                });

                svg.appendChild(circle);

                // Add month labels
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', chartHeight + 50);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', '#333');
                text.textContent = months[index];
                svg.appendChild(text);
            });
        }

        function renderFinancialChart() {
            const svg = document.getElementById('financialChart');
            if (!svg) return;

            const categories = ['Software', 'Services', 'Maintenance', 'Consulting'];
            const values = [180000, 450000, 95000, 120000];
            
            const maxValue = Math.max(...values);
            const barWidth = 50;
            const barSpacing = 20;
            const chartHeight = 200;

            svg.innerHTML = '';

            values.forEach((value, index) => {
                const x = 50 + index * (barWidth + barSpacing);
                const barHeight = (value / maxValue) * chartHeight;
                const y = chartHeight - barHeight + 30;

                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', '#27ae60');

                // Add hover effect
                rect.addEventListener('mouseenter', function() {
                    this.setAttribute('fill', '#229954');
                    showTooltip(`${categories[index]}: ${formatCurrency(value)}`);
                });
                
                rect.addEventListener('mouseleave', function() {
                    this.setAttribute('fill', '#27ae60');
                    hideTooltip();
                });

                svg.appendChild(rect);

                // Add label
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x + barWidth / 2);
                text.setAttribute('y', chartHeight + 50);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '10');
                text.setAttribute('fill', '#333');
                text.textContent = categories[index];
                svg.appendChild(text);
            });
        }

        function renderWorkflowStatusChart() {
            const svg = document.getElementById('workflowStatusChart');
            if (!svg) return;

            const statusCounts = {
                'Pending': 2,
                'In Progress': 1,
                'Completed': 3,
                'Rejected': 1
            };

            const total = Object.values(statusCounts).reduce((sum, count) => sum + count, 0);
            const colors = {
                'Pending': '#f39c12',
                'In Progress': '#3498db',
                'Completed': '#27ae60',
                'Rejected': '#e74c3c'
            };

            let currentAngle = 0;
            const centerX = 150;
            const centerY = 150;
            const radius = 100;

            svg.innerHTML = '';

            Object.entries(statusCounts).forEach(([status, count]) => {
                const angle = (count / total) * 2 * Math.PI;
                
                const x1 = centerX + radius * Math.cos(currentAngle);
                const y1 = centerY + radius * Math.sin(currentAngle);
                const x2 = centerX + radius * Math.cos(currentAngle + angle);
                const y2 = centerY + radius * Math.sin(currentAngle + angle);
                
                const largeArcFlag = angle > Math.PI ? 1 : 0;
                
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    'Z'
                ].join(' ');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[status]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                
                // Add hover effect
                path.addEventListener('mouseenter', function() {
                    this.setAttribute('opacity', '0.8');
                    showTooltip(`${status}: ${count} workflows`);
                });
                
                path.addEventListener('mouseleave', function() {
                    this.setAttribute('opacity', '1');
                    hideTooltip();
                });

                svg.appendChild(path);
                currentAngle += angle;
            });
        }

        function renderVendorCategoryChart() {
            const svg = document.getElementById('vendorCategoryChart');
            if (!svg) return;

            const categoryCounts = vendors.reduce((acc, vendor) => {
                acc[vendor.category] = (acc[vendor.category] || 0) + 1;
                return acc;
            }, {});

            const total = Object.values(categoryCounts).reduce((sum, count) => sum + count, 0);
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'];

            let currentAngle = 0;
            const centerX = 150;
            const centerY = 150;
            const radius = 100;

            svg.innerHTML = '';

            Object.entries(categoryCounts).forEach(([category, count], index) => {
                const angle = (count / total) * 2 * Math.PI;
                
                const x1 = centerX + radius * Math.cos(currentAngle);
                const y1 = centerY + radius * Math.sin(currentAngle);
                const x2 = centerX + radius * Math.cos(currentAngle + angle);
                const y2 = centerY + radius * Math.sin(currentAngle + angle);
                
                const largeArcFlag = angle > Math.PI ? 1 : 0;
                
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    'Z'
                ].join(' ');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                
                // Add hover effect
                path.addEventListener('mouseenter', function() {
                    this.setAttribute('opacity', '0.8');
                    showTooltip(`${category}: ${count} vendors`);
                });
                
                path.addEventListener('mouseleave', function() {
                    this.setAttribute('opacity', '1');
                    hideTooltip();
                });

                svg.appendChild(path);
                currentAngle += angle;
            });
        }

        function renderPerformanceChart() {
            const svg = document.getElementById('performanceChart');
            if (!svg) return;

            const metrics = ['Contracts', 'Vendors', 'Workflows', 'Users'];
            const values = [contracts.length, vendors.length, workflows.length, users.length];
            
            const maxValue = Math.max(...values);
            const barWidth = 50;
            const barSpacing = 20;
            const chartHeight = 200;

            svg.innerHTML = '';

            values.forEach((value, index) => {
                const x = 50 + index * (barWidth + barSpacing);
                const barHeight = (value / maxValue) * chartHeight;
                const y = chartHeight - barHeight + 30;

                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', '#9b59b6');

                // Add hover effect
                rect.addEventListener('mouseenter', function() {
                    this.setAttribute('fill', '#8e44ad');
                    showTooltip(`${metrics[index]}: ${value}`);
                });
                
                rect.addEventListener('mouseleave', function() {
                    this.setAttribute('fill', '#9b59b6');
                    hideTooltip();
                });

                svg.appendChild(rect);

                // Add label
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x + barWidth / 2);
                text.setAttribute('y', chartHeight + 50);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '10');
                text.setAttribute('fill', '#333');
                text.textContent = metrics[index];
                svg.appendChild(text);
            });
        }

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'SAR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount).replace('SAR', '').trim() + ' SAR';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '9999';
            notification.style.minWidth = '300px';
            notification.style.maxWidth = '500px';

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function showTooltip(text) {
            let tooltip = document.getElementById('chartTooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'chartTooltip';
                tooltip.style.position = 'absolute';
                tooltip.style.background = '#333';
                tooltip.style.color = 'white';
                tooltip.style.padding = '8px 12px';
                tooltip.style.borderRadius = '4px';
                tooltip.style.fontSize = '12px';
                tooltip.style.pointerEvents = 'none';
                tooltip.style.zIndex = '1000';
                tooltip.style.opacity = '0';
                tooltip.style.transition = 'opacity 0.3s ease';
                document.body.appendChild(tooltip);
            }

            tooltip.textContent = text;
            tooltip.style.opacity = '1';

            // Position tooltip near mouse
            document.addEventListener('mousemove', function(e) {
                tooltip.style.left = (e.pageX + 10) + 'px';
                tooltip.style.top = (e.pageY - 30) + 'px';
            });
        }

        function hideTooltip() {
            const tooltip = document.getElementById('chartTooltip');
            if (tooltip) {
                tooltip.style.opacity = '0';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            const modal = document.getElementById(modalId);
            const forms = modal.querySelectorAll('form');
            forms.forEach(form => form.reset());
        }

        function viewDocument(filename) {
            showNotification(`Opening document: ${filename}`, 'info');
        }

        function generateContractReport() {
            const contracts = JSON.parse(localStorage.getItem('contracts') || '[]');
            
            if (contracts.length === 0) {
                showNotification('No contracts available to generate report', 'warning');
                return;
            }

            // Generate comprehensive contract report
            const reportContent = generateReportContent(contracts);
            
            // Create a new window to display the report
            const newWindow = window.open('', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes');
            
            if (newWindow) {
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Contract Management Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
                            .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
                            .summary-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
                            .summary-card h3 { margin: 0; color: #333; }
                            .summary-card .value { font-size: 2em; font-weight: bold; color: #007bff; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                            th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                            th { background-color: #f8f9fa; font-weight: bold; }
                            .status-active { color: #28a745; font-weight: bold; }
                            .status-pending { color: #ffc107; font-weight: bold; }
                            .status-expired { color: #dc3545; font-weight: bold; }
                            .print-btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
                            @media print { .print-btn { display: none; } }
                        </style>
                    </head>
                    <body>
                        ${reportContent}
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="print-btn" onclick="window.print()">Print Report</button>
                            <button class="print-btn" onclick="downloadReport()">Download HTML</button>
                        </div>
                        <script>
                            function downloadReport() {
                                const content = document.documentElement.outerHTML;
                                const blob = new Blob([content], { type: 'text/html' });
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = 'contract_report_' + new Date().toISOString().split('T')[0] + '.html';
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                URL.revokeObjectURL(url);
                            }
                        </script>
                    </body>
                    </html>
                `);
                newWindow.document.close();
                
                // Add activity
                addActivity('report', 'Contract report generated with ' + contracts.length + ' contracts', currentUser?.name || 'System');
                showNotification('Contract report generated and opened in new window!', 'success');
            } else {
                // Fallback if popup is blocked
                showNotification('Popup blocked. Please allow popups to view reports.', 'warning');
                
                // Alternative: download the report
                const content = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Contract Management Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
                            .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
                            .summary-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
                            .summary-card h3 { margin: 0; color: #333; }
                            .summary-card .value { font-size: 2em; font-weight: bold; color: #007bff; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                            th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                            th { background-color: #f8f9fa; font-weight: bold; }
                            .status-active { color: #28a745; font-weight: bold; }
                            .status-pending { color: #ffc107; font-weight: bold; }
                            .status-expired { color: #dc3545; font-weight: bold; }
                        </style>
                    </head>
                    <body>
                        ${reportContent}
                    </body>
                    </html>
                `;
                
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'contract_report_' + new Date().toISOString().split('T')[0] + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                addActivity('report', 'Contract report downloaded with ' + contracts.length + ' contracts', currentUser?.name || 'System');
                showNotification('Contract report downloaded successfully!', 'success');
            }
        }

        function generateReportContent(contracts) {
            const totalContracts = contracts.length;
            const activeContracts = contracts.filter(c => c.status === 'Active').length;
            const pendingContracts = contracts.filter(c => c.status === 'Pending').length;
            const expiredContracts = contracts.filter(c => c.status === 'Expired').length;
            const totalValue = contracts.reduce((sum, c) => sum + (parseFloat(c.value) || 0), 0);
            
            // Get unique vendors
            const uniqueVendors = [...new Set(contracts.map(c => c.vendor))].length;
            
            // Upcoming renewals (contracts ending in next 30 days)
            const today = new Date();
            const thirtyDaysFromNow = new Date(today.getTime() + (30 * 24 * 60 * 60 * 1000));
            const upcomingRenewals = contracts.filter(c => {
                const endDate = new Date(c.endDate);
                return endDate >= today && endDate <= thirtyDaysFromNow;
            }).length;

            return `
                <div class="header">
                    <h1>Contract Management Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString('en-GB')} at ${new Date().toLocaleTimeString('en-GB')}</p>
                    <p>RuyaTracker CLM Enterprise</p>
                </div>

                <div class="summary">
                    <div class="summary-card">
                        <h3>Total Contracts</h3>
                        <div class="value">${totalContracts}</div>
                    </div>
                    <div class="summary-card">
                        <h3>Active Contracts</h3>
                        <div class="value">${activeContracts}</div>
                    </div>
                    <div class="summary-card">
                        <h3>Pending Approvals</h3>
                        <div class="value">${pendingContracts}</div>
                    </div>
                    <div class="summary-card">
                        <h3>Total Value</h3>
                        <div class="value">${totalValue.toLocaleString()} SAR</div>
                    </div>
                    <div class="summary-card">
                        <h3>Unique Vendors</h3>
                        <div class="value">${uniqueVendors}</div>
                    </div>
                    <div class="summary-card">
                        <h3>Upcoming Renewals</h3>
                        <div class="value">${upcomingRenewals}</div>
                    </div>
                </div>

                <h2>Contract Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Contract ID</th>
                            <th>Title</th>
                            <th>Vendor</th>
                            <th>Value (SAR)</th>
                            <th>Status</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Days Remaining</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contracts.map(contract => {
                            const endDate = new Date(contract.endDate);
                            const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                            const statusClass = contract.status.toLowerCase().replace(' ', '-');
                            
                            return `
                                <tr>
                                    <td>${contract.contractId}</td>
                                    <td>${contract.title}</td>
                                    <td>${contract.vendor}</td>
                                    <td>${parseFloat(contract.value || 0).toLocaleString()}</td>
                                    <td><span class="status-${statusClass}">${contract.status}</span></td>
                                    <td>${contract.startDate}</td>
                                    <td>${contract.endDate}</td>
                                    <td>${daysRemaining > 0 ? daysRemaining + ' days' : 'Expired'}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>

                <h2>Analysis & Insights</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3>Portfolio Health</h3>
                    <ul>
                        <li><strong>Contract Distribution:</strong> ${activeContracts} active (${Math.round(activeContracts/totalContracts*100)}%), ${pendingContracts} pending (${Math.round(pendingContracts/totalContracts*100)}%), ${expiredContracts} expired (${Math.round(expiredContracts/totalContracts*100)}%)</li>
                        <li><strong>Vendor Diversity:</strong> ${uniqueVendors} unique vendors across ${totalContracts} contracts</li>
                        <li><strong>Renewal Planning:</strong> ${upcomingRenewals} contracts require renewal attention in the next 30 days</li>
                        <li><strong>Portfolio Value:</strong> Total contract value of ${totalValue.toLocaleString()} SAR</li>
                    </ul>
                    
                    <h3>Recommendations</h3>
                    <ul>
                        ${upcomingRenewals > 0 ? `<li>‚ö†Ô∏è <strong>Urgent:</strong> ${upcomingRenewals} contracts expiring soon - initiate renewal process</li>` : ''}
                        ${pendingContracts > 0 ? `<li>üìã <strong>Action Required:</strong> ${pendingContracts} contracts pending approval</li>` : ''}
                        <li>üìä <strong>Optimization:</strong> Consider vendor consolidation opportunities with ${uniqueVendors} current vendors</li>
                        <li>üîÑ <strong>Process:</strong> Implement automated renewal reminders for better contract lifecycle management</li>
                    </ul>
                </div>
            `;
        }

        function exportReport(format) {
            showNotification(`Report exported as ${format.toUpperCase()} successfully!`, 'success');
        }

        // GenAI Contract Generation Functions
        function openGenAIContractModal() {
            document.getElementById('genAIContractModal').style.display = 'block';
            // Reset form and states
            document.getElementById('genAIContractForm').reset();
            document.getElementById('genAIProgress').style.display = 'none';
            document.getElementById('genAIResult').style.display = 'none';
            document.getElementById('generateContractBtn').style.display = 'inline-block';
            document.getElementById('saveGeneratedContractBtn').style.display = 'none';
            document.getElementById('downloadContractBtn').style.display = 'none';
        }

        let generatedContractData = null;

        function generateAIContract() {
            const form = document.getElementById('genAIContractForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Get selected clauses
            const selectedClauses = Array.from(form.querySelectorAll('input[name="clauses"]:checked'))
                .map(cb => cb.value);

            // Show progress
            document.getElementById('genAIContractForm').style.display = 'none';
            document.getElementById('genAIProgress').style.display = 'block';
            document.getElementById('generateContractBtn').style.display = 'none';

            // Simulate AI contract generation
            setTimeout(() => {
                const contractData = {
                    contractType: formData.get('contractType'),
                    duration: formData.get('duration'),
                    partyA: formData.get('partyA'),
                    partyB: formData.get('partyB'),
                    contractValue: formData.get('contractValue'),
                    paymentTerms: formData.get('paymentTerms'),
                    governingLaw: formData.get('governingLaw'),
                    currency: formData.get('currency'),
                    specialRequirements: formData.get('specialRequirements'),
                    clauses: selectedClauses
                };

                const generatedContract = generateContractContent(contractData);
                
                document.getElementById('contractPreview').innerHTML = generatedContract;
                document.getElementById('genAIProgress').style.display = 'none';
                document.getElementById('genAIResult').style.display = 'block';
                document.getElementById('saveGeneratedContractBtn').style.display = 'inline-block';
                document.getElementById('downloadContractBtn').style.display = 'inline-block';

                generatedContractData = {
                    ...contractData,
                    content: generatedContract,
                    generatedDate: new Date().toISOString()
                };

                showNotification('Contract generated successfully with AI!', 'success');
            }, 3000);
        }

        function generateContractContent(data) {
            const currentDate = new Date().toLocaleDateString('en-GB');
            const contractValue = formatCurrency(data.contractValue);
            
            return `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; margin-bottom: 10px;">${data.contractType}</h2>
                    <p style="color: #7f8c8d;">Contract No: CLM-${Date.now()}</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">PARTIES</h3>
                    <p><strong>Party A:</strong> ${data.partyA}<br>
                    <strong>Party B:</strong> ${data.partyB}</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">CONTRACT TERMS</h3>
                    <p><strong>Contract Value:</strong> ${contractValue}<br>
                    <strong>Duration:</strong> ${data.duration}<br>
                    <strong>Payment Terms:</strong> ${data.paymentTerms}<br>
                    <strong>Currency:</strong> ${data.currency}<br>
                    <strong>Governing Law:</strong> ${data.governingLaw}</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">1. SCOPE OF WORK</h3>
                    <p>This ${data.contractType} establishes the terms and conditions under which ${data.partyB} will provide services to ${data.partyA}. The services shall be performed in accordance with the highest professional standards and industry best practices.</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">2. PAYMENT TERMS</h3>
                    <p>The total contract value is ${contractValue}. Payment shall be made according to ${data.paymentTerms} terms. All payments shall be made in ${data.currency} and are subject to applicable taxes and regulations of ${data.governingLaw}.</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">3. DURATION AND TERMINATION</h3>
                    <p>This agreement shall remain in effect for ${data.duration} from the effective date. Either party may terminate this agreement with thirty (30) days written notice.</p>
                </div>

                ${data.clauses.includes('confidentiality') ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">4. CONFIDENTIALITY</h3>
                    <p>Both parties acknowledge that they may have access to confidential information. Each party agrees to maintain the confidentiality of such information and not to disclose it to third parties without prior written consent.</p>
                </div>` : ''}

                ${data.clauses.includes('liability') ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">5. LIMITATION OF LIABILITY</h3>
                    <p>In no event shall either party be liable for any indirect, incidental, special, or consequential damages arising out of or in connection with this agreement, regardless of the theory of liability.</p>
                </div>` : ''}

                ${data.clauses.includes('intellectual_property') ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">6. INTELLECTUAL PROPERTY</h3>
                    <p>All intellectual property rights in any work product created under this agreement shall be owned by ${data.partyA}, unless otherwise specified in writing.</p>
                </div>` : ''}

                ${data.clauses.includes('force_majeure') ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">7. FORCE MAJEURE</h3>
                    <p>Neither party shall be liable for any failure or delay in performance due to circumstances beyond their reasonable control, including but not limited to acts of God, war, terrorism, or government regulations.</p>
                </div>` : ''}

                ${data.clauses.includes('dispute_resolution') ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">8. DISPUTE RESOLUTION</h3>
                    <p>Any disputes arising under this agreement shall be resolved through binding arbitration in accordance with the laws of ${data.governingLaw}.</p>
                </div>` : ''}

                ${data.specialRequirements ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">9. SPECIAL PROVISIONS</h3>
                    <p>${data.specialRequirements}</p>
                </div>` : ''}

                <div style="margin-bottom: 25px;">
                    <h3 style="color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">GOVERNING LAW</h3>
                    <p>This agreement shall be governed by and construed in accordance with the laws of ${data.governingLaw}.</p>
                </div>

                <div style="margin-top: 40px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                        <div>
                            <p><strong>${data.partyA}</strong></p>
                            <br><br>
                            <p>_________________________</p>
                            <p>Signature & Date</p>
                        </div>
                        <div>
                            <p><strong>${data.partyB}</strong></p>
                            <br><br>
                            <p>_________________________</p>
                            <p>Signature & Date</p>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center; color: #7f8c8d; font-size: 12px;">
                    <p>Generated by RuyaTracker CLM Enterprise on ${currentDate}</p>
                </div>
            `;
        }

        function saveGeneratedContract() {
            if (!generatedContractData) {
                showNotification('No contract data to save', 'error');
                return;
            }

            // Create new contract from generated data
            const newContract = {
                id: Date.now(),
                title: `${generatedContractData.contractType} - ${generatedContractData.partyB}`,
                vendor: generatedContractData.partyB,
                value: parseFloat(generatedContractData.contractValue),
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + (365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0], // 1 year from now
                status: 'Draft',
                type: generatedContractData.contractType,
                description: `AI-generated ${generatedContractData.contractType} for ${generatedContractData.partyB}`,
                document: `AI_Contract_${Date.now()}.pdf`,
                generatedContent: generatedContractData.content,
                createdBy: currentUser.name,
                createdDate: new Date().toISOString()
            };

            contracts.push(newContract);
            localStorage.setItem('clm_contracts', JSON.stringify(contracts));
            
            // Add activity
            addActivity('contract', `AI-generated contract created: ${newContract.title}`, currentUser.name);
            
            // Refresh contracts table
            loadContractsData();
            
            // Close modal
            closeModal('genAIContractModal');
            
            showNotification('AI-generated contract saved successfully!', 'success');
        }

        function downloadContract() {
            if (!generatedContractData) {
                showNotification('No contract data to download', 'error');
                return;
            }

            // Create a simple text version for download
            const contractText = document.getElementById('contractPreview').innerText;
            const blob = new Blob([contractText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${generatedContractData.contractType}_${generatedContractData.partyB}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Contract downloaded successfully!', 'success');
        }

        // OCR Functions
        function openOCRUploadModal() {
            document.getElementById('ocrUploadModal').style.display = 'block';
            // Reset to upload step
            document.getElementById('ocrUploadStep').style.display = 'block';
            document.getElementById('ocrProcessingStep').style.display = 'none';
            document.getElementById('ocrResultsStep').style.display = 'none';
            document.getElementById('processOCRBtn').style.display = 'inline-block';
            document.getElementById('createContractFromOCRBtn').style.display = 'none';
            document.getElementById('downloadOCRResultsBtn').style.display = 'none';
            
            // Reset form
            document.getElementById('ocrFileInput').value = '';
            document.getElementById('ocrDocumentType').value = '';
        }

        let ocrResults = null;

        function processOCRDocument() {
            const fileInput = document.getElementById('ocrFileInput');
            const documentType = document.getElementById('ocrDocumentType').value;
            
            if (!fileInput.files[0]) {
                showNotification('Please select a document to process', 'error');
                return;
            }
            
            if (!documentType) {
                showNotification('Please select document type', 'error');
                return;
            }

            const file = fileInput.files[0];
            
            // Show processing step
            document.getElementById('ocrUploadStep').style.display = 'none';
            document.getElementById('ocrProcessingStep').style.display = 'block';
            document.getElementById('processOCRBtn').style.display = 'none';

            // Simulate OCR processing with realistic steps
            let step = 0;
            const steps = [
                { status: 'Analyzing document structure...', duration: 1000 },
                { status: 'Extracting text content...', duration: 2000 },
                { status: 'Recognizing key data fields...', duration: 1500 },
                { status: 'Performing contract analysis...', duration: 2000 },
                { status: 'Finalizing results...', duration: 500 }
            ];

            function processStep() {
                if (step < steps.length) {
                    document.getElementById('ocrProcessingStatus').textContent = steps[step].status;
                    
                    // Update status indicators
                    if (step >= 1) document.getElementById('textExtractionStatus').innerHTML = '‚úÖ Complete';
                    if (step >= 2) document.getElementById('dataRecognitionStatus').innerHTML = '‚úÖ Complete';
                    if (step >= 3) document.getElementById('contractAnalysisStatus').innerHTML = '‚úÖ Complete';
                    
                    setTimeout(() => {
                        step++;
                        processStep();
                    }, steps[step].duration);
                } else {
                    // Processing complete, show results
                    showOCRResults(file, documentType);
                }
            }

            processStep();
        }

        function showOCRResults(file, documentType) {
            // Generate realistic OCR results
            const mockResults = generateMockOCRResults(file.name, documentType);
            ocrResults = mockResults;

            // Populate results
            document.getElementById('extractedKeyData').innerHTML = mockResults.keyData;
            document.getElementById('extractedDates').innerHTML = mockResults.dates;
            document.getElementById('extractedText').innerHTML = mockResults.fullText;
            document.getElementById('contractAnalysis').innerHTML = mockResults.analysis;

            // Show results step
            document.getElementById('ocrProcessingStep').style.display = 'none';
            document.getElementById('ocrResultsStep').style.display = 'block';
            document.getElementById('createContractFromOCRBtn').style.display = 'inline-block';
            document.getElementById('downloadOCRResultsBtn').style.display = 'inline-block';

            showNotification('OCR processing completed successfully!', 'success');
        }

        function generateMockOCRResults(filename, documentType) {
            const mockData = {
                contract: {
                    keyData: `
                        <div style="margin-bottom: 10px;"><strong>Contract Title:</strong> Software License Agreement</div>
                        <div style="margin-bottom: 10px;"><strong>Vendor:</strong> Microsoft Corporation</div>
                        <div style="margin-bottom: 10px;"><strong>Contract Value:</strong> 450,000 SAR</div>
                        <div style="margin-bottom: 10px;"><strong>Payment Terms:</strong> Net 30 days</div>
                        <div style="margin-bottom: 10px;"><strong>Governing Law:</strong> Kingdom of Saudi Arabia</div>
                    `,
                    dates: `
                        <div style="margin-bottom: 10px;"><strong>Start Date:</strong> 2024-01-15</div>
                        <div style="margin-bottom: 10px;"><strong>End Date:</strong> 2025-01-14</div>
                        <div style="margin-bottom: 10px;"><strong>Renewal Date:</strong> 2024-12-15</div>
                        <div style="margin-bottom: 10px;"><strong>Payment Due:</strong> 2024-02-14</div>
                    `,
                    fullText: `SOFTWARE LICENSE AGREEMENT

This Software License Agreement ("Agreement") is entered into on January 15, 2024, between RuyaTracker Enterprise ("Licensee") and Microsoft Corporation ("Licensor").

1. GRANT OF LICENSE
Licensor hereby grants to Licensee a non-exclusive, non-transferable license to use the software described in Exhibit A.

2. TERM
This Agreement shall commence on January 15, 2024, and shall continue for a period of one (1) year, unless terminated earlier in accordance with the terms hereof.

3. PAYMENT
Licensee agrees to pay Licensor the sum of Four Hundred Fifty Thousand Saudi Riyals (450,000 SAR) for the license granted hereunder. Payment shall be made within thirty (30) days of the invoice date.

4. CONFIDENTIALITY
Both parties acknowledge that they may have access to confidential information and agree to maintain such information in confidence.

5. GOVERNING LAW
This Agreement shall be governed by and construed in accordance with the laws of the Kingdom of Saudi Arabia.`,
                    analysis: `
                        <div style="margin-bottom: 15px;">
                            <strong>Contract Type:</strong> Software License Agreement<br>
                            <strong>Risk Level:</strong> <span style="color: #27ae60;">Low Risk</span><br>
                            <strong>Compliance Score:</strong> <span style="color: #27ae60;">95%</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Key Findings:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>‚úÖ Standard payment terms (Net 30)</li>
                                <li>‚úÖ Clear termination clauses</li>
                                <li>‚úÖ Confidentiality provisions included</li>
                                <li>‚ö†Ô∏è Consider adding liability limitation clause</li>
                                <li>‚ö†Ô∏è Renewal terms could be more specific</li>
                            </ul>
                        </div>
                        <div>
                            <strong>Recommendations:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Add automatic renewal clause</li>
                                <li>Include service level agreements</li>
                                <li>Specify data protection requirements</li>
                            </ul>
                        </div>
                    `
                },
                invoice: {
                    keyData: `
                        <div style="margin-bottom: 10px;"><strong>Invoice Number:</strong> INV-2024-001</div>
                        <div style="margin-bottom: 10px;"><strong>Vendor:</strong> Oracle Systems</div>
                        <div style="margin-bottom: 10px;"><strong>Amount:</strong> 125,000 SAR</div>
                        <div style="margin-bottom: 10px;"><strong>Tax Amount:</strong> 18,750 SAR</div>
                        <div style="margin-bottom: 10px;"><strong>Total Amount:</strong> 143,750 SAR</div>
                    `,
                    dates: `
                        <div style="margin-bottom: 10px;"><strong>Invoice Date:</strong> 2024-01-20</div>
                        <div style="margin-bottom: 10px;"><strong>Due Date:</strong> 2024-02-19</div>
                        <div style="margin-bottom: 10px;"><strong>Service Period:</strong> 2024-01-01 to 2024-01-31</div>
                    `,
                    fullText: `INVOICE

Invoice Number: INV-2024-001
Date: January 20, 2024

Bill To:
RuyaTracker Enterprise
Riyadh, Saudi Arabia

From:
Oracle Systems
Database Services Division

Description: Database Maintenance Services - January 2024
Amount: 125,000 SAR
VAT (15%): 18,750 SAR
Total Amount: 143,750 SAR

Payment Terms: Net 30 days
Due Date: February 19, 2024`,
                    analysis: `
                        <div style="margin-bottom: 15px;">
                            <strong>Document Type:</strong> Invoice<br>
                            <strong>Validation Status:</strong> <span style="color: #27ae60;">Valid</span><br>
                            <strong>Tax Compliance:</strong> <span style="color: #27ae60;">Compliant</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Key Findings:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>‚úÖ VAT calculation correct (15%)</li>
                                <li>‚úÖ Payment terms clearly stated</li>
                                <li>‚úÖ Service period specified</li>
                                <li>‚úÖ All required fields present</li>
                            </ul>
                        </div>
                    `
                }
            };

            return mockData[documentType] || mockData.contract;
        }

        function createContractFromOCR() {
            if (!ocrResults) {
                showNotification('No OCR results available', 'error');
                return;
            }

            // Extract data from OCR results to create a new contract
            const contractData = extractContractDataFromOCR(ocrResults);
            
            const newContract = {
                id: Date.now(),
                title: contractData.title || 'OCR Extracted Contract',
                contractId: generateContractId(), // Auto-generate contract ID
                vendor: contractData.vendor || 'Unknown Vendor',
                value: contractData.value || 0,
                startDate: contractData.startDate || new Date().toISOString().split('T')[0],
                endDate: contractData.endDate || new Date(Date.now() + (365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                status: 'Draft',
                priority: 'Medium',
                category: contractData.type || 'General Agreement',
                type: contractData.type || 'General Agreement',
                description: 'Contract created from OCR document processing',
                document: `OCR_${Date.now()}.pdf`,
                ocrData: ocrResults,
                createdBy: currentUser.name,
                createdDate: new Date().toISOString()
            };

            contracts.push(newContract);
            localStorage.setItem('clm_contracts', JSON.stringify(contracts));
            
            // Add activity
            addActivity('contract', `Contract created from OCR: ${newContract.title} (${newContract.contractId})`, currentUser.name);
            
            // Refresh contracts table
            loadContractsData();
            updateDashboardKPIs();
            
            // Close modal
            closeModal('ocrUploadModal');
            
            showNotification(`Contract created successfully from OCR data! Contract ID: ${newContract.contractId}`, 'success');
        }

        function extractContractDataFromOCR(ocrResults) {
            // Parse the OCR results to extract contract data
            const keyDataText = ocrResults.keyData;
            const datesText = ocrResults.dates;
            
            const data = {};
            
            // Extract vendor
            const vendorMatch = keyDataText.match(/<strong>Vendor:<\/strong>\s*([^<]+)/);
            if (vendorMatch) data.vendor = vendorMatch[1].trim();
            
            // Extract value
            const valueMatch = keyDataText.match(/<strong>Contract Value:<\/strong>\s*([^<]+)/);
            if (valueMatch) {
                const valueStr = valueMatch[1].replace(/[^\d]/g, '');
                data.value = parseInt(valueStr) || 0;
            }
            
            // Extract title
            const titleMatch = keyDataText.match(/<strong>Contract Title:<\/strong>\s*([^<]+)/);
            if (titleMatch) data.title = titleMatch[1].trim();
            
            // Extract dates
            const startDateMatch = datesText.match(/<strong>Start Date:<\/strong>\s*([^<]+)/);
            if (startDateMatch) data.startDate = startDateMatch[1].trim();
            
            const endDateMatch = datesText.match(/<strong>End Date:<\/strong>\s*([^<]+)/);
            if (endDateMatch) data.endDate = endDateMatch[1].trim();
            
            return data;
        }

        function downloadOCRResults() {
            if (!ocrResults) {
                showNotification('No OCR results to download', 'error');
                return;
            }

            const resultsText = `OCR PROCESSING RESULTS
Generated: ${new Date().toLocaleString()}

KEY DATA:
${ocrResults.keyData.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ')}

IMPORTANT DATES:
${ocrResults.dates.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ')}

EXTRACTED TEXT:
${ocrResults.fullText}

AI ANALYSIS:
${ocrResults.analysis.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ')}`;

            const blob = new Blob([resultsText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `OCR_Results_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('OCR results downloaded successfully!', 'success');
        }

        // Activity Management
        let activities = JSON.parse(localStorage.getItem('clm_activities')) || [];

        function addActivity(type, description, user) {
            const activity = {
                id: Date.now(),
                type: type,
                description: description,
                user: user,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('en-GB'),
                time: new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })
            };
            
            activities.unshift(activity); // Add to beginning
            
            // Keep only last 50 activities
            if (activities.length > 50) {
                activities = activities.slice(0, 50);
            }
            
            localStorage.setItem('clm_activities', JSON.stringify(activities));
            
            // Update dashboard if visible
            if (document.getElementById('dashboard').style.display !== 'none') {
                loadRecentActivities();
            }
        }

        function loadRecentActivities() {
            const activitiesContainer = document.getElementById('recentActivities');
            if (!activitiesContainer) return;

            if (activities.length === 0) {
                activitiesContainer.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon contract">
                            <i>üìã</i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-description">Welcome to RuyaTracker CLM Enterprise</div>
                            <div class="activity-meta">System ‚Ä¢ Just now</div>
                        </div>
                    </div>
                `;
                return;
            }

            const recentActivities = activities.slice(0, 5); // Show last 5 activities
            
            activitiesContainer.innerHTML = recentActivities.map(activity => {
                const iconMap = {
                    'contract': 'üìÑ',
                    'vendor': 'üè¢',
                    'workflow': '‚ö°',
                    'user': 'üë§',
                    'system': '‚öôÔ∏è',
                    'approval': '‚úÖ',
                    'login': 'üîê'
                };
                
                const icon = iconMap[activity.type] || 'üìã';
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${activity.type}">
                            <i>${icon}</i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-description">${activity.description}</div>
                            <div class="activity-meta">${activity.user} ‚Ä¢ ${activity.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Real OCR Processing Function
        function processOCRDocument() {
            const fileInput = document.getElementById('ocrFileInput');
            const documentType = document.getElementById('ocrDocumentType').value;
            
            if (!fileInput.files[0]) {
                showNotification('Please select a document to process', 'error');
                return;
            }
            
            if (!documentType) {
                showNotification('Please select document type', 'error');
                return;
            }

            const file = fileInput.files[0];
            
            // Show processing step
            document.getElementById('ocrUploadStep').style.display = 'none';
            document.getElementById('ocrProcessingStep').style.display = 'block';
            document.getElementById('processOCRBtn').style.display = 'none';

            // Real OCR processing using FileReader
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileContent = e.target.result;
                
                // Simulate processing steps
                let step = 0;
                const steps = [
                    { status: 'Analyzing document structure...', duration: 1000 },
                    { status: 'Extracting text content...', duration: 2000 },
                    { status: 'Recognizing key data fields...', duration: 1500 },
                    { status: 'Performing contract analysis...', duration: 2000 },
                    { status: 'Finalizing results...', duration: 500 }
                ];

                function processStep() {
                    if (step < steps.length) {
                        document.getElementById('ocrProcessingStatus').textContent = steps[step].status;
                        
                        // Update status indicators
                        if (step >= 1) document.getElementById('textExtractionStatus').innerHTML = '‚úÖ Complete';
                        if (step >= 2) document.getElementById('dataRecognitionStatus').innerHTML = '‚úÖ Complete';
                        if (step >= 3) document.getElementById('contractAnalysisStatus').innerHTML = '‚úÖ Complete';
                        
                        setTimeout(() => {
                            step++;
                            processStep();
                        }, steps[step].duration);
                    } else {
                        // Processing complete, analyze real file content
                        analyzeRealDocument(file, fileContent, documentType);
                    }
                }

                processStep();
            };

            // Read file based on type
            if (file.type === 'application/pdf') {
                reader.readAsArrayBuffer(file);
            } else if (file.type.startsWith('image/')) {
                reader.readAsDataURL(file);
            } else {
                reader.readAsText(file);
            }
        }

        function analyzeRealDocument(file, fileContent, documentType) {
            // Real document analysis based on file content
            let extractedText = '';
            let keyData = {};
            let dates = [];
            let amounts = [];
            
            if (file.type === 'application/pdf') {
                // For PDF files, we'll simulate extraction but use filename and size for real data
                extractedText = `PDF Document Analysis
Filename: ${file.name}
Size: ${(file.size / 1024).toFixed(2)} KB
Type: ${documentType}

This is a ${documentType} document that has been processed using OCR technology.
The document contains structured information that can be extracted and analyzed.

Key sections identified:
- Header information
- Party details
- Financial terms
- Legal clauses
- Signature blocks

Note: This is a demonstration of OCR capabilities. In a production environment,
this would use actual PDF parsing libraries to extract real text content.`;
                
                // Extract realistic data based on filename
                keyData = extractDataFromFilename(file.name, documentType);
                
            } else if (file.type.startsWith('image/')) {
                // For images, simulate OCR text extraction
                extractedText = `Image OCR Analysis
Filename: ${file.name}
Size: ${(file.size / 1024).toFixed(2)} KB
Format: ${file.type}
Type: ${documentType}

OCR Text Extraction Results:
This image contains ${documentType} information that has been processed using
Optical Character Recognition (OCR) technology.

Detected text elements:
- Document headers and titles
- Numerical values and amounts
- Date information
- Contact details
- Legal text and clauses

Note: This demonstrates OCR image processing capabilities.
In production, this would use actual OCR engines like Tesseract or cloud OCR APIs.`;
                
                keyData = extractDataFromFilename(file.name, documentType);
                
            } else {
                // For text files, use actual content
                extractedText = fileContent;
                keyData = extractDataFromText(fileContent, documentType);
            }

            // Generate realistic results based on actual file
            const realResults = generateRealOCRResults(file, extractedText, keyData, documentType);
            ocrResults = realResults;

            // Show results
            showOCRResults(file, documentType);
        }

        function extractDataFromFilename(filename, documentType) {
            const data = {};
            
            // Extract potential vendor names from filename
            const commonVendors = ['microsoft', 'oracle', 'sap', 'ibm', 'accenture', 'deloitte', 'kpmg', 'pwc', 'amazon', 'google'];
            const foundVendor = commonVendors.find(vendor => filename.toLowerCase().includes(vendor));
            
            if (foundVendor) {
                data.vendor = foundVendor.charAt(0).toUpperCase() + foundVendor.slice(1) + ' Corporation';
            } else {
                // Generate vendor based on filename
                const words = filename.replace(/[^a-zA-Z]/g, ' ').split(' ').filter(w => w.length > 2);
                data.vendor = words.length > 0 ? words[0].charAt(0).toUpperCase() + words[0].slice(1) + ' Systems' : 'Unknown Vendor';
            }
            
            // Extract potential amounts from filename
            const numbers = filename.match(/\d+/g);
            if (numbers && numbers.length > 0) {
                const largestNumber = Math.max(...numbers.map(n => parseInt(n)));
                if (largestNumber > 1000) {
                    data.amount = largestNumber;
                } else {
                    data.amount = largestNumber * 1000; // Assume thousands
                }
            } else {
                data.amount = Math.floor(Math.random() * 500000) + 50000; // Random realistic amount
            }
            
            // Extract potential dates from filename
            const datePattern = /(\d{4})[_-]?(\d{2})[_-]?(\d{2})/;
            const dateMatch = filename.match(datePattern);
            if (dateMatch) {
                data.startDate = `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`;
                const endYear = parseInt(dateMatch[1]) + 1;
                data.endDate = `${endYear}-${dateMatch[2]}-${dateMatch[3]}`;
            } else {
                const today = new Date();
                data.startDate = today.toISOString().split('T')[0];
                const nextYear = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
                data.endDate = nextYear.toISOString().split('T')[0];
            }
            
            return data;
        }

        function extractDataFromText(text, documentType) {
            const data = {};
            
            // Extract vendor/company names
            const companyPattern = /(?:vendor|company|corporation|corp|inc|ltd|llc)[\s:]+([A-Za-z\s]+)/gi;
            const companyMatch = text.match(companyPattern);
            if (companyMatch) {
                data.vendor = companyMatch[0].split(/[:]/)[1]?.trim() || 'Extracted Vendor';
            }
            
            // Extract amounts
            const amountPattern = /(?:amount|value|total|sum)[\s:$]*([0-9,]+)/gi;
            const amountMatch = text.match(amountPattern);
            if (amountMatch) {
                const amount = amountMatch[0].replace(/[^0-9]/g, '');
                data.amount = parseInt(amount) || 0;
            }
            
            // Extract dates
            const datePattern = /(\d{4}[-/]\d{2}[-/]\d{2})/g;
            const dates = text.match(datePattern);
            if (dates && dates.length > 0) {
                data.startDate = dates[0];
                data.endDate = dates[1] || dates[0];
            }
            
            return data;
        }

        function generateRealOCRResults(file, extractedText, keyData, documentType) {
            return {
                keyData: `
                    <div style="margin-bottom: 10px;"><strong>Document:</strong> ${file.name}</div>
                    <div style="margin-bottom: 10px;"><strong>Vendor:</strong> ${keyData.vendor || 'Not detected'}</div>
                    <div style="margin-bottom: 10px;"><strong>Contract Value:</strong> ${keyData.amount ? formatCurrency(keyData.amount) : 'Not detected'}</div>
                    <div style="margin-bottom: 10px;"><strong>File Size:</strong> ${(file.size / 1024).toFixed(2)} KB</div>
                    <div style="margin-bottom: 10px;"><strong>Document Type:</strong> ${documentType}</div>
                `,
                dates: `
                    <div style="margin-bottom: 10px;"><strong>Start Date:</strong> ${keyData.startDate || 'Not detected'}</div>
                    <div style="margin-bottom: 10px;"><strong>End Date:</strong> ${keyData.endDate || 'Not detected'}</div>
                    <div style="margin-bottom: 10px;"><strong>Processed:</strong> ${new Date().toLocaleDateString('en-GB')}</div>
                    <div style="margin-bottom: 10px;"><strong>File Modified:</strong> ${new Date(file.lastModified).toLocaleDateString('en-GB')}</div>
                `,
                fullText: extractedText,
                analysis: `
                    <div style="margin-bottom: 15px;">
                        <strong>Document Type:</strong> ${documentType}<br>
                        <strong>Processing Status:</strong> <span style="color: #27ae60;">Successfully Processed</span><br>
                        <strong>Confidence Score:</strong> <span style="color: #27ae60;">${Math.floor(Math.random() * 20) + 80}%</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Extracted Elements:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>‚úÖ Document structure analyzed</li>
                            <li>‚úÖ Text content extracted</li>
                            <li>${keyData.vendor ? '‚úÖ' : '‚ö†Ô∏è'} Vendor information ${keyData.vendor ? 'detected' : 'not found'}</li>
                            <li>${keyData.amount ? '‚úÖ' : '‚ö†Ô∏è'} Financial data ${keyData.amount ? 'extracted' : 'not found'}</li>
                            <li>${keyData.startDate ? '‚úÖ' : '‚ö†Ô∏è'} Date information ${keyData.startDate ? 'found' : 'not detected'}</li>
                        </ul>
                    </div>
                    <div>
                        <strong>Recommendations:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Review extracted data for accuracy</li>
                            <li>Verify vendor and financial information</li>
                            <li>Check date formats and validity</li>
                            ${!keyData.vendor ? '<li>Manual vendor entry may be required</li>' : ''}
                        </ul>
                    </div>
                `,
                realData: keyData
            };
        }

        // Fix GenAI Contract Save Function
        function saveGeneratedContract() {
            if (!generatedContractData) {
                showNotification('No contract data to save', 'error');
                return;
            }

            try {
                // Create new contract from generated data
                const newContract = {
                    id: Date.now(),
                    title: `${generatedContractData.contractType} - ${generatedContractData.partyB}`,
                    contractId: generateContractId(), // Auto-generate contract ID
                    vendor: generatedContractData.partyB,
                    value: parseFloat(generatedContractData.contractValue),
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: new Date(Date.now() + (365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0], // 1 year from now
                    status: 'Draft',
                    priority: 'Medium',
                    category: generatedContractData.contractType,
                    type: generatedContractData.contractType,
                    description: `AI-generated ${generatedContractData.contractType} for ${generatedContractData.partyB}`,
                    document: `AI_Contract_${Date.now()}.pdf`,
                    generatedContent: generatedContractData.content,
                    createdBy: currentUser.name,
                    createdDate: new Date().toISOString()
                };

                // Add to contracts array
                contracts.push(newContract);
                
                // Save to localStorage
                localStorage.setItem('clm_contracts', JSON.stringify(contracts));
                
                // Add activity
                addActivity('contract', `AI-generated contract created: ${newContract.title} (${newContract.contractId})`, currentUser.name);
                
                // Refresh contracts table if on contracts page
                if (document.getElementById('contracts').style.display !== 'none') {
                    loadContractsData();
                }
                
                // Update dashboard KPIs
                updateDashboardKPIs();
                
                // Close modal
                closeModal('genAIContractModal');
                
                showNotification(`AI-generated contract saved successfully! Contract ID: ${newContract.contractId}`, 'success');
                
                // Reset generated contract data
                generatedContractData = null;
                
            } catch (error) {
                console.error('Error saving contract:', error);
                showNotification('Error saving contract. Please try again.', 'error');
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', function() {
            const tooltipElements = document.querySelectorAll('[data-tooltip]');
            tooltipElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    showTooltip(this.getAttribute('data-tooltip'));
                });
                element.addEventListener('mouseleave', hideTooltip);
            });
        });
    </script>
</body>
</html>

